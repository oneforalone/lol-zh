<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>生产代码 &mdash; Let Over Lambda 中文文档  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="源代码" href="original-code.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Let Over Lambda 中文文档
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="preface.html">译者序</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter01.html">第一章：概述</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter02.html">第二章：闭包</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter03.html">第三章：宏基础</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter04.html">第四章：读取宏 <sup>（1）</sup></a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter05.html">第五章：Programs that program <sup>（1）</sup></a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter06.html">第六章：回指 <sup>（1）</sup> 宏</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter07.html">第七章：宏的效率</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter08.html">第八章：Lisp 和 Forth</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendices.html">附录</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">参考文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="specification.html">术语表</a></li>
<li class="toctree-l1"><a class="reference internal" href="original-code.html">源代码</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">生产代码</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#license">License 说明</a></li>
<li class="toctree-l2"><a class="reference internal" href="#weired-by-design">代码架构</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#t">t</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id4">产品代码</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">t</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#let-over-lambda-lisp">let-over-lambda.lisp</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#group"><code class="docutils literal notranslate"><span class="pre">group</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#mkstr"><code class="docutils literal notranslate"><span class="pre">mkstr</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#symb"><code class="docutils literal notranslate"><span class="pre">symb</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#flatten"><code class="docutils literal notranslate"><span class="pre">flatten</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#g-symbol-p"><code class="docutils literal notranslate"><span class="pre">g!-symbol-p</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#o-symbol-p"><code class="docutils literal notranslate"><span class="pre">o!-symbol-p</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#o-symbol-to-g-symbol"><code class="docutils literal notranslate"><span class="pre">o!-symbol-to-g!-symbol</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#defmacro-g"><code class="docutils literal notranslate"><span class="pre">defmacro/g!</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#defmacro"><code class="docutils literal notranslate"><span class="pre">defmacro!</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#defun"><code class="docutils literal notranslate"><span class="pre">defun!</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#reader"><code class="docutils literal notranslate"><span class="pre">|#&quot;-reader|</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8"><code class="docutils literal notranslate"><span class="pre">|#&gt;-reader|</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#segment-reader"><code class="docutils literal notranslate"><span class="pre">segment-reader</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#match-mode-ppcre-lambda-form"><code class="docutils literal notranslate"><span class="pre">match-mode-ppcre-lambda-form</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id10"><code class="docutils literal notranslate"><span class="pre">|#~-reader|</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dlambda"><code class="docutils literal notranslate"><span class="pre">dlambda</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#alambda"><code class="docutils literal notranslate"><span class="pre">alambda</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#aif"><code class="docutils literal notranslate"><span class="pre">aif</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id12"><code class="docutils literal notranslate"><span class="pre">|#`-reader|</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#f-reader"><code class="docutils literal notranslate"><span class="pre">|#f-reader|</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#lol-syntax"><code class="docutils literal notranslate"><span class="pre">lol-syntax</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#nlet-tail"><code class="docutils literal notranslate"><span class="pre">nlet-tail</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#alet"><code class="docutils literal notranslate"><span class="pre">alet%</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#alet2"><code class="docutils literal notranslate"><span class="pre">alet</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#let-binding-transform"><code class="docutils literal notranslate"><span class="pre">let-binding-transform</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pandoriclet"><code class="docutils literal notranslate"><span class="pre">pandoriclet</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pandoriclet-get"><code class="docutils literal notranslate"><span class="pre">pandoriclet-get</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pandoriclet-set"><code class="docutils literal notranslate"><span class="pre">pandoriclet-set</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#get-pandoric"><code class="docutils literal notranslate"><span class="pre">get-pandoric</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id15"><code class="docutils literal notranslate"><span class="pre">get-pandoric</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#with-pandoric"><code class="docutils literal notranslate"><span class="pre">with-pandoric</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pandoric-hotpatch"><code class="docutils literal notranslate"><span class="pre">pandoric-hotpatch</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pandoric-recode"><code class="docutils literal notranslate"><span class="pre">pandoric-recode</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#plambda"><code class="docutils literal notranslate"><span class="pre">plambda</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pandoric-eval-tunnel"><code class="docutils literal notranslate"><span class="pre">pandoric-eval-tunnel</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#pandoric-eval"><code class="docutils literal notranslate"><span class="pre">pandoric-eval</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#fast-progn"><code class="docutils literal notranslate"><span class="pre">fast-progn</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#safe-progn"><code class="docutils literal notranslate"><span class="pre">safe-progn</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#fformat"><code class="docutils literal notranslate"><span class="pre">fformat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#id17"><code class="docutils literal notranslate"><span class="pre">fformat</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#inline-make-tlist-tlist-left-tlist-right-tlist-empty-p"><code class="docutils literal notranslate"><span class="pre">inline</span> <span class="pre">make-tlist</span> <span class="pre">tlist-left</span> <span class="pre">tlist-right</span> <span class="pre">tlist-empty-p</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-tlist"><code class="docutils literal notranslate"><span class="pre">make-tlist</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#tlist-left"><code class="docutils literal notranslate"><span class="pre">tlist-left</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#tlist-right"><code class="docutils literal notranslate"><span class="pre">tlist-right</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#tlist-empty-p"><code class="docutils literal notranslate"><span class="pre">tlist-empty-p</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#inline-tlist-add-left-tlist-add-right"><code class="docutils literal notranslate"><span class="pre">inline</span> <span class="pre">tlist-add-left</span> <span class="pre">tlist-add-right</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#tlist-add-left"><code class="docutils literal notranslate"><span class="pre">tlist-add-left</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#tlist-add-right"><code class="docutils literal notranslate"><span class="pre">tlist-add-right</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#tlist-rem-left"><code class="docutils literal notranslate"><span class="pre">tlist-rem-left</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#tlist-update"><code class="docutils literal notranslate"><span class="pre">tlist-update</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#build-batcher-sn"><code class="docutils literal notranslate"><span class="pre">build-batcher-sn</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#sortf"><code class="docutils literal notranslate"><span class="pre">sortf</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dollar-symbol-p"><code class="docutils literal notranslate"><span class="pre">dollar-symbol-p</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#if-match"><code class="docutils literal notranslate"><span class="pre">if-match</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#when-match"><code class="docutils literal notranslate"><span class="pre">when-match</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#travis-yml">.travis.yml</a></li>
<li class="toctree-l2"><a class="reference internal" href="#circle-yml">circle.yml</a></li>
<li class="toctree-l2"><a class="reference internal" href="#let-over-lambda-asd">let-over-lambda.asd</a></li>
<li class="toctree-l2"><a class="reference internal" href="#let-over-lambda-lisp-whole">let-over-lambda.lisp(whole)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#let-over-lambda-test-asd">let-over-lambda-test.asd</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id24">LICENSE</a></li>
<li class="toctree-l2"><a class="reference internal" href="#package-lisp">package.lisp</a></li>
<li class="toctree-l2"><a class="reference internal" href="#readme-md">README.md</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id26">End</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Let Over Lambda 中文文档</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>生产代码</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/production-code.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="production-code">
<span id="id1"></span><h1>生产代码<a class="headerlink" href="#production-code" title="Permalink to this heading"></a></h1>
<p>GitHub Repo: <a class="reference external" href="https://github.com/thephoeron/let-over-lambda">https://github.com/thephoeron/let-over-lambda</a></p>
<p>项目目录结构</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(in-package cl-user)

(defpackage let-over-lambda-test
(:use cl let-over-lambda prove)
(:import-from named-readtables
                in-readtable))

(in-package let-over-lambda-test)

(in-readtable lol-syntax)

;; NOTE: To run this test file, execute `(asdf:test-system :let-over-lambda)&#39; in your Lisp.

(plan 8)

(defun! fn! ()
`(let ((,g!test 123))
    ,g!test))

(defmacro fn-macro ()
(fn!))

(deftest defun!-test
(is-expand (fn-macro)
            (LET (($TEST 123))
            $TEST)))

(defparameter flatten-list `(D (E (F ,&#39;(G)))))

(deftest flatten-test
(is (flatten &#39;((A . B) (C D (E) (F (G)))))
    &#39;(A B C D E F G)
    &quot;FLATTEN function works as expected.&quot;)
(is (flatten `(A B C ,flatten-list))
    &#39;(A B C D E F G)
    &quot;FLATTEN on quasiquotes works as expected.&quot;))

(defparameter heredoc-string #&gt;END
I can put anything here: &quot;, , &quot;# and &gt;# are
no problem. The only thing that will terminate
the reading of this string is...END)

(deftest heredoc-read-macro-test
(is heredoc-string
    &quot;I can put anything here: \&quot;, , \&quot;# and &gt;# are
no problem. The only thing that will terminate
the reading of this string is...&quot;
    &quot;SHARP-GREATER-THEN read macro works as expected.&quot;))

(deftest pilfered-perl-regex-syntax-test
(is-expand &#39;#~m|\w+tp://|
            &#39;(lambda ($str) (cl-ppcre:scan-to-strings &quot;\\w+tp://&quot; $str))
            &quot;#~m expands correctly.&quot;)
(is-expand &#39;#~s/abc/def/
            &#39;(lambda ($str) (cl-ppcre:regex-replace-all &quot;abc&quot; $str &quot;def&quot;))
            &quot;#~s expands correctly.&quot;)
(is-values (#~m/abc/ &quot;123abc&quot;)
            &#39;(&quot;abc&quot; #())
            &quot;#~m runs correctly.&quot;
            :test #&#39;equalp)
(is (#~s/abc/def/ &quot;Testing abc testing abc&quot;)
    &quot;Testing def testing def&quot;
    &quot;#~s runs correctly.&quot;))

(deftest read-anaphor-sharp-backquote-test
(is &#39;#`((,a1))
    &#39;(lambda (a1) `((,a1)))
    &quot;SHARP-BACKQUOTE expands correctly.&quot;
    :test #&#39;equalp)
(is-expand #.(#3`(((,@a2)) ,a3 (,a1 ,a1))
                (gensym)
                &#39;(a b c)
                &#39;hello)
            (((a b c)) hello ($g $g))
            &quot;SHARP-BACKQUOTE runs correctly, respecting order, gensyms, nesting, numarg, etc.&quot;))

(deftest sharp-f-test
(is &#39;#f
    &#39;(declare (optimize (speed 3) (safety 0)))
    &quot;Default numarg SHARP-F expands correctly.&quot;)
(is &#39;#0f
    &#39;(declare (optimize (speed 0) (safety 3)))
    &quot;Numarg = 3 SHARP-F expands correctly.&quot;)
(is &#39;(#1f #2f)
    &#39;((declare (optimize (speed 1) (safety 2)))
        (declare (optimize (speed 2) (safety 1))))
    &quot;SHARP-F correctly expands into rarely used compiler options.&quot;))

(deftest |test-#&quot;&quot;#-read-macro|
(is #&quot;Contains &quot; and \.&quot;#
    &quot;Contains \&quot; and \\.&quot;
    &quot;SHARP-QUOTE read macro works as expected.&quot;))

(deftest if-match-test
(is (if-match (#~m_a(b)c_ &quot;abc&quot;)
        $1)
    &quot;b&quot;
    &quot;IF-MATCH correctly returns the single capture.&quot;)
(is-error (if-match (#~m_a(b)c_ &quot;abc&quot;)
                $2)
            &#39;simple-error
            &quot;IF-MATCH throws an error when $2 is unbound.&quot;)
(is (if-match (#~m_a(b)c_ &quot;def&quot;)
        $1
        :else)
    :else
    &quot;When IF-MATCH test is false it goes to the else body.&quot;)
(is (if-match (#~m_a(b)c_ &quot;abc&quot;)
        (if-match (#~m_(d)(e)f_ &quot;def&quot;)
            (list $1 $2)
            :no-second-match)
        $1)
    &#39;(&quot;d&quot; &quot;e&quot;)
    &quot;IF-MATCH works with nested IF-MATCHs.&quot;)
(is (if-match (#~m_a(b)c_ &quot;abc&quot;)
        (if-match (#~m_(d)(e)f_ &quot;d ef&quot;)
            (list $1 $2)
            :no-second-match)
        $1)
    :no-second-match
    &quot;IF-MATCH works with nested IF-MATCHs.&quot;)
(is-error (if-match (#~m_a(b)c_ &quot;ab c&quot;)
                (if-match (#~m_(d)(e)f_ &quot;d ef&quot;)
                    (list $1 $2)
                    :no-second-match)
                $1)
            &#39;simple-error
            &quot;IF-MATCH throws an error, even when nested.&quot;)
(is-error (if-match (#~m_a(b)c_ &quot;ab c&quot;)
                (if-match (#~m_(d)(e)f_ &quot;d ef&quot;)
                    (list $1 $2)
                    :no-second-match)
                $2)
            &#39;simple-error
            &quot;IF-MATCH throws an error, even when nested.&quot;))

(run-test-all)
</pre></div>
</div>
<div class="toctree-wrapper compound">
</div>
<section id="license">
<span id="id2"></span><h2>License 说明<a class="headerlink" href="#license" title="Permalink to this heading"></a></h2>
<p>Antiweb (C) Doug Hoyte</p>
<p>This is a “production” version of LOL with bug-fixes
and new features in the spirit of the book.</p>
<p>See <a class="reference external" href="http://letoverlambda.com">http://letoverlambda.com</a></p>
<p>This is the source code for the book
_Let_Over_Lambda_ by Doug Hoyte.
This code is (C) 2002-2008, Doug Hoyte.</p>
<p>You are free to use, modify, and re-distribute
this code however you want, except that any
modifications must be clearly indicated before
re-distribution. There is no warranty,
expressed nor implied.</p>
<p>Attribution of this code to me, Doug Hoyte, is
appreciated but not necessary. If you find the
code useful, or would like documentation,
please consider buying the book!</p>
<p>Modifications by “the Phoeron” Colin J.E. Lupton, 2012–2014
- Support for ASDF/Quicklisp
- Cheap hacks to support new Backquote implementation in SBCL v1.2.2</p>
<p>Safety feature for SBCL&gt;=v1.2.2</p>
</section>
<section id="weired-by-design">
<span id="id3"></span><h2>代码架构<a class="headerlink" href="#weired-by-design" title="Permalink to this heading"></a></h2>
<blockquote>
<div><img alt="_images/production-code.png" src="_images/production-code.png" />
<img alt="_images/production-code2.png" src="_images/production-code2.png" />
<img alt="_images/production-code3.png" src="_images/production-code3.png" />
</div></blockquote>
<section id="t">
<h3>t<a class="headerlink" href="#t" title="Permalink to this heading"></a></h3>
<p><a class="reference internal" href="#let-over-lambda-lisp"><span class="std std-ref">let-over-lambda.lisp</span></a></p>
<p><a class="reference internal" href="#travis-yml"><span class="std std-ref">.travis.yml</span></a></p>
<p><a class="reference internal" href="#circle-yml"><span class="std std-ref">circle.yml</span></a></p>
<p><a class="reference internal" href="#let-over-lambda-asd"><span class="std std-ref">let-over-lambda.asd</span></a></p>
<p><a class="reference internal" href="#let-over-lambda-lisp"><span class="std std-ref">let-over-lambda.lisp</span></a></p>
<p><a class="reference internal" href="#let-over-lambda-test-asd"><span class="std std-ref">let-over-lambda-test.asd</span></a></p>
<p><span class="xref std std-ref">LICENSE</span></p>
<p><span class="xref std std-ref">package.lisp</span></p>
<p><a class="reference internal" href="#readme-md"><span class="std std-ref">README.md</span></a></p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defvar</span><span class="w"> </span><span class="nv">forth-registers</span><span class="w"></span>
<span class="linenos">2</span><span class="w">  </span><span class="o">&#39;</span><span class="p">(</span><span class="nv">pstack</span><span class="w"> </span><span class="nv">rstack</span><span class="w"> </span><span class="nv">pc</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="nv">dict</span><span class="w"> </span><span class="nv">compiling</span><span class="w"> </span><span class="nv">dtable</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
<p>;; This is the source code for the book
;; _Let_Over_Lambda_ by Doug Hoyte.
;; This code is (C) 2002-2008, Doug Hoyte.
;;
;; You are free to use, modify, and re-distribute
;; this code however you want, except that any
;; modifications must be clearly indicated before
;; re-distribution. There is no warranty,
;; expressed nor implied.
;;
;; Attribution of this code to me, Doug Hoyte, is
;; appreciated but not necessary. If you find the
;; code useful, or would like documentation,
;; please consider buying the book!</p>
<p>(defvar lol-edition “1.0”)</p>
</section>
</section>
<section id="id4">
<span id="id5"></span><h2>产品代码<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h2>
<section id="id6">
<h3>t<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h3>
<section id="let-over-lambda-lisp">
<span id="id7"></span><h4>let-over-lambda.lisp<a class="headerlink" href="#let-over-lambda-lisp" title="Permalink to this heading"></a></h4>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">;;;; -*- Mode: LISP; Syntax: COMMON-LISP; Package: LET-OVER-LAMBDA; Base: 10 -*- file: let-over-lambda.lisp</span><span class="w"></span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="p">(</span><span class="nb">in-package</span><span class="w"> </span><span class="ss">#:let-over-lambda</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="c1">;; Antiweb (C) Doug Hoyte</span><span class="w"></span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="c1">;; This is a &quot;production&quot; version of LOL with bug-fixes</span><span class="w"></span>
<span class="linenos"> 8</span><span class="c1">;; and new features in the spirit of the book.</span><span class="w"></span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="c1">;; See http://letoverlambda.com</span><span class="w"></span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1">;; This is the source code for the book</span><span class="w"></span>
<span class="linenos">13</span><span class="c1">;; _Let_Over_Lambda_ by Doug Hoyte.</span><span class="w"></span>
<span class="linenos">14</span><span class="c1">;; This code is (C) 2002-2008, Doug Hoyte.</span><span class="w"></span>
<span class="linenos">15</span><span class="c1">;;</span><span class="w"></span>
<span class="linenos">16</span><span class="c1">;; You are free to use, modify, and re-distribute</span><span class="w"></span>
<span class="linenos">17</span><span class="c1">;; this code however you want, except that any</span><span class="w"></span>
<span class="linenos">18</span><span class="c1">;; modifications must be clearly indicated before</span><span class="w"></span>
<span class="linenos">19</span><span class="c1">;; re-distribution. There is no warranty,</span><span class="w"></span>
<span class="linenos">20</span><span class="c1">;; expressed nor implied.</span><span class="w"></span>
<span class="linenos">21</span><span class="c1">;;</span><span class="w"></span>
<span class="linenos">22</span><span class="c1">;; Attribution of this code to me, Doug Hoyte, is</span><span class="w"></span>
<span class="linenos">23</span><span class="c1">;; appreciated but not necessary. If you find the</span><span class="w"></span>
<span class="linenos">24</span><span class="c1">;; code useful, or would like documentation,</span><span class="w"></span>
<span class="linenos">25</span><span class="c1">;; please consider buying the book!</span><span class="w"></span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="c1">;; Modifications by &quot;the Phoeron&quot; Colin J.E. Lupton, 2012--2014</span><span class="w"></span>
<span class="linenos">28</span><span class="c1">;; - Support for ASDF/Quicklisp</span><span class="w"></span>
<span class="linenos">29</span><span class="c1">;; - Cheap hacks to support new Backquote implementation in SBCL v1.2.2</span><span class="w"></span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="c1">;; Safety feature for SBCL&gt;=v1.2.2</span><span class="w"></span>
<span class="linenos">32</span><span class="o">#+</span><span class="nv">sbcl</span><span class="w"></span>
<span class="linenos">33</span><span class="p">(</span><span class="k">eval-when</span><span class="w"> </span><span class="p">(</span><span class="ss">:compile-toplevel</span><span class="w"> </span><span class="ss">:execute</span><span class="p">)</span><span class="w"></span>
<span class="linenos">34</span><span class="p">(</span><span class="nb">handler-case</span><span class="w"></span>
<span class="linenos">35</span><span class="w">    </span><span class="p">(</span><span class="k">progn</span><span class="w"></span>
<span class="linenos">36</span><span class="w">        </span><span class="p">(</span><span class="nv">sb-ext:assert-version-&gt;=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">37</span><span class="w">        </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="vg">*features*</span><span class="w"> </span><span class="p">(</span><span class="nb">remove</span><span class="w"> </span><span class="ss">&#39;old-sbcl</span><span class="w"> </span><span class="vg">*features*</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">38</span><span class="w">    </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="p">()</span><span class="w"></span>
<span class="linenos">39</span><span class="w">    </span><span class="p">(</span><span class="nb">pushnew</span><span class="w"> </span><span class="ss">&#39;old-sbcl</span><span class="w"> </span><span class="vg">*features*</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="group">
<span id="group2"></span><h2><code class="docutils literal notranslate"><span class="pre">group</span></code><a class="headerlink" href="#group" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">group</span><span class="w"> </span><span class="p">(</span><span class="nv">source</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">zerop</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="s">&quot;zero length&quot;</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 3</span><span class="p">(</span><span class="k">labels</span><span class="w"> </span><span class="p">((</span><span class="nv">rec</span><span class="w"> </span><span class="p">(</span><span class="nv">source</span><span class="w"> </span><span class="nv">acc</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">            </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nb">rest</span><span class="w"> </span><span class="p">(</span><span class="nb">nthcdr</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">source</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">            </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">consp</span><span class="w"> </span><span class="nb">rest</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">                </span><span class="p">(</span><span class="nv">rec</span><span class="w"> </span><span class="nb">rest</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">                            </span><span class="p">(</span><span class="nb">subseq</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">                            </span><span class="nv">acc</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">                </span><span class="p">(</span><span class="nb">nreverse</span><span class="w"></span>
<span class="linenos">10</span><span class="w">                    </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="nv">acc</span><span class="p">))))))</span><span class="w"></span>
<span class="linenos">11</span><span class="w">    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="p">(</span><span class="nv">rec</span><span class="w"> </span><span class="nv">source</span><span class="w"> </span><span class="no">nil</span><span class="p">)</span><span class="w"> </span><span class="no">nil</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="p">(</span><span class="k">eval-when</span><span class="w"> </span><span class="p">(</span><span class="ss">:compile-toplevel</span><span class="w"> </span><span class="ss">:execute</span><span class="w"> </span><span class="ss">:load-toplevel</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="mkstr">
<span id="mkstr2"></span><h2><code class="docutils literal notranslate"><span class="pre">mkstr</span></code><a class="headerlink" href="#mkstr" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">mkstr</span><span class="w"> </span><span class="p">(</span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">args</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="p">(</span><span class="nb">with-output-to-string</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="nb">dolist</span><span class="w"> </span><span class="p">(</span><span class="nv">a</span><span class="w"> </span><span class="nv">args</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">princ</span><span class="w"> </span><span class="nv">a</span><span class="w"> </span><span class="nv">s</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="symb">
<span id="symb2"></span><h2><code class="docutils literal notranslate"><span class="pre">symb</span></code><a class="headerlink" href="#symb" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">symb</span><span class="w"> </span><span class="p">(</span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">args</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="p">(</span><span class="nb">values</span><span class="w"> </span><span class="p">(</span><span class="nb">intern</span><span class="w"> </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">mkstr</span><span class="w"> </span><span class="nv">args</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="flatten">
<span id="flatten2"></span><h2><code class="docutils literal notranslate"><span class="pre">flatten</span></code><a class="headerlink" href="#flatten" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">flatten</span><span class="w"> </span><span class="p">(</span><span class="nv">x</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w">    </span><span class="p">(</span><span class="k">labels</span><span class="w"> </span><span class="p">((</span><span class="nv">rec</span><span class="w"> </span><span class="p">(</span><span class="nv">x</span><span class="w"> </span><span class="nv">acc</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">                </span><span class="p">(</span><span class="nb">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">null</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="nv">acc</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">                        </span><span class="o">#+</span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="nv">sbcl</span><span class="w"> </span><span class="p">(</span><span class="nb">not</span><span class="w"> </span><span class="nv">lol::old-sbcl</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">                        </span><span class="p">((</span><span class="nb">typep</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="ss">&#39;sb-impl::comma</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">rec</span><span class="w"> </span><span class="p">(</span><span class="nv">sb-impl::comma-expr</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="nv">acc</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">                        </span><span class="p">((</span><span class="nb">atom</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="nv">acc</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">                        </span><span class="p">(</span><span class="no">t</span><span class="w"> </span><span class="p">(</span><span class="nv">rec</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">                            </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">                            </span><span class="p">(</span><span class="nv">rec</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="nv">acc</span><span class="p">))))))</span><span class="w"></span>
<span class="linenos">10</span><span class="w">    </span><span class="p">(</span><span class="nv">rec</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="no">nil</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="g-symbol-p">
<span id="g-symbol-p2"></span><h2><code class="docutils literal notranslate"><span class="pre">g!-symbol-p</span></code><a class="headerlink" href="#g-symbol-p" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">g!-symbol-p</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="p">(</span><span class="nb">symbolp</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="w">        </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">s</span><span class="p">))</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4</span><span class="w">        </span><span class="p">(</span><span class="nb">string=</span><span class="w"> </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5</span><span class="w">                </span><span class="s">&quot;G!&quot;</span><span class="w"></span>
<span class="linenos">6</span><span class="w">                </span><span class="ss">:start1</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">7</span><span class="w">                </span><span class="ss">:end1</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="o-symbol-p">
<span id="o-symbol-p2"></span><h2><code class="docutils literal notranslate"><span class="pre">o!-symbol-p</span></code><a class="headerlink" href="#o-symbol-p" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">o!-symbol-p</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="p">(</span><span class="nb">symbolp</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="w">        </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">s</span><span class="p">))</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4</span><span class="w">        </span><span class="p">(</span><span class="nb">string=</span><span class="w"> </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5</span><span class="w">                </span><span class="s">&quot;O!&quot;</span><span class="w"></span>
<span class="linenos">6</span><span class="w">                </span><span class="ss">:start1</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos">7</span><span class="w">                </span><span class="ss">:end1</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="o-symbol-to-g-symbol">
<span id="o-symbol-to-g-symbol2"></span><h2><code class="docutils literal notranslate"><span class="pre">o!-symbol-to-g!-symbol</span></code><a class="headerlink" href="#o-symbol-to-g-symbol" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">o!-symbol-to-g!-symbol</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="p">(</span><span class="nv">symb</span><span class="w"> </span><span class="s">&quot;G!&quot;</span><span class="w"></span>
<span class="linenos">3</span><span class="w">        </span><span class="p">(</span><span class="nb">subseq</span><span class="w"> </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="mi">2</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="defmacro-g">
<span id="defmacro-g-2"></span><h2><code class="docutils literal notranslate"><span class="pre">defmacro/g!</span></code><a class="headerlink" href="#defmacro-g" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">defmacro/g!</span><span class="w"> </span><span class="p">(</span><span class="nv">name</span><span class="w"> </span><span class="nv">args</span><span class="w"> </span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">syms</span><span class="w"> </span><span class="p">(</span><span class="nb">remove-duplicates</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">            </span><span class="p">(</span><span class="nb">remove-if-not</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">g!-symbol-p</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">                            </span><span class="p">(</span><span class="nv">flatten</span><span class="w"> </span><span class="nv">body</span><span class="p">)))))</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p">(</span><span class="nb">multiple-value-bind</span><span class="w"> </span><span class="p">(</span><span class="nv">body</span><span class="w"> </span><span class="nv">declarations</span><span class="w"> </span><span class="nv">docstring</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">        </span><span class="p">(</span><span class="nv">parse-body</span><span class="w"> </span><span class="nv">body</span><span class="w"> </span><span class="ss">:documentation</span><span class="w"> </span><span class="no">t</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">    </span><span class="o">`</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="o">,</span><span class="nv">name</span><span class="w"> </span><span class="o">,</span><span class="nv">args</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">        </span><span class="o">,@</span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="nv">docstring</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">            </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="nv">docstring</span><span class="p">))</span><span class="w"></span>
<span class="linenos">10</span><span class="w">        </span><span class="o">,@</span><span class="nv">declarations</span><span class="w"></span>
<span class="linenos">11</span><span class="w">        </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="o">,</span><span class="p">(</span><span class="nb">mapcar</span><span class="w"></span>
<span class="linenos">12</span><span class="w">                </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">13</span><span class="w">                </span><span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">s</span><span class="w"> </span><span class="p">(</span><span class="nb">gensym</span><span class="w"> </span><span class="o">,</span><span class="p">(</span><span class="nb">subseq</span><span class="w"></span>
<span class="linenos">14</span><span class="w">                                </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">15</span><span class="w">                                </span><span class="mi">2</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">16</span><span class="w">                </span><span class="nv">syms</span><span class="p">)</span><span class="w"></span>
<span class="linenos">17</span><span class="w">        </span><span class="o">,@</span><span class="nv">body</span><span class="p">)))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="defmacro">
<span id="defmacro-2"></span><h2><code class="docutils literal notranslate"><span class="pre">defmacro!</span></code><a class="headerlink" href="#defmacro" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">defmacro!</span><span class="w"> </span><span class="p">(</span><span class="nv">name</span><span class="w"> </span><span class="nv">args</span><span class="w"> </span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="k">let*</span><span class="w"> </span><span class="p">((</span><span class="nv">os</span><span class="w"> </span><span class="p">(</span><span class="nb">remove-if-not</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">o!-symbol-p</span><span class="w"> </span><span class="p">(</span><span class="nv">flatten</span><span class="w"> </span><span class="nv">args</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">        </span><span class="p">(</span><span class="nv">gs</span><span class="w"> </span><span class="p">(</span><span class="nb">mapcar</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">o!-symbol-to-g!-symbol</span><span class="w"> </span><span class="nv">os</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">    </span><span class="p">(</span><span class="nb">multiple-value-bind</span><span class="w"> </span><span class="p">(</span><span class="nv">body</span><span class="w"> </span><span class="nv">declarations</span><span class="w"> </span><span class="nv">docstring</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">        </span><span class="p">(</span><span class="nv">parse-body</span><span class="w"> </span><span class="nv">body</span><span class="w"> </span><span class="ss">:documentation</span><span class="w"> </span><span class="no">t</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">    </span><span class="o">`</span><span class="p">(</span><span class="nv">defmacro/g!</span><span class="w"> </span><span class="o">,</span><span class="nv">name</span><span class="w"> </span><span class="o">,</span><span class="nv">args</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">        </span><span class="o">,@</span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="nv">docstring</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">            </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="nv">docstring</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">        </span><span class="o">,@</span><span class="nv">declarations</span><span class="w"></span>
<span class="linenos">10</span><span class="w">        </span><span class="o">`</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="o">,</span><span class="p">(</span><span class="nb">mapcar</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">,@</span><span class="nv">gs</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">,@</span><span class="nv">os</span><span class="p">))</span><span class="w"></span>
<span class="linenos">11</span><span class="w">            </span><span class="o">,</span><span class="p">(</span><span class="k">progn</span><span class="w"> </span><span class="o">,@</span><span class="nv">body</span><span class="p">))))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="defun">
<span id="defun-2"></span><h2><code class="docutils literal notranslate"><span class="pre">defun!</span></code><a class="headerlink" href="#defun" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">defun!</span><span class="w"> </span><span class="p">(</span><span class="nv">name</span><span class="w"> </span><span class="nv">args</span><span class="w"> </span><span class="k">&amp;body</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">syms</span><span class="w"> </span><span class="p">(</span><span class="nb">remove-duplicates</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">            </span><span class="p">(</span><span class="nb">remove-if-not</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">g!-symbol-p</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">                            </span><span class="p">(</span><span class="nv">flatten</span><span class="w"> </span><span class="nv">body</span><span class="p">)))))</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p">(</span><span class="nb">multiple-value-bind</span><span class="w"> </span><span class="p">(</span><span class="nv">body</span><span class="w"> </span><span class="nv">declarations</span><span class="w"> </span><span class="nv">docstring</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">        </span><span class="p">(</span><span class="nv">parse-body</span><span class="w"> </span><span class="nv">body</span><span class="w"> </span><span class="ss">:documentation</span><span class="w"> </span><span class="no">t</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">    </span><span class="o">`</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="o">,</span><span class="nv">name</span><span class="w"> </span><span class="o">,</span><span class="nv">args</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">        </span><span class="o">,@</span><span class="p">(</span><span class="nb">when</span><span class="w"> </span><span class="nv">docstring</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">            </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="nv">docstring</span><span class="p">))</span><span class="w"></span>
<span class="linenos">10</span><span class="w">        </span><span class="o">,@</span><span class="nv">declarations</span><span class="w"></span>
<span class="linenos">11</span><span class="w">        </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="o">,</span><span class="p">(</span><span class="nb">mapcar</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">12</span><span class="w">                        </span><span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="nv">s</span><span class="w"> </span><span class="p">(</span><span class="nb">gensym</span><span class="w"> </span><span class="o">,</span><span class="p">(</span><span class="nb">subseq</span><span class="w"> </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">13</span><span class="w">                                            </span><span class="mi">2</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">14</span><span class="w">                    </span><span class="nv">syms</span><span class="p">)</span><span class="w"></span>
<span class="linenos">15</span><span class="w">        </span><span class="o">,@</span><span class="nv">body</span><span class="p">)))))</span><span class="w"></span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="c1">;; Nestable suggestion from Daniel Herring</span><span class="w"></span>
<span class="linenos">18</span><span class="p">(</span><span class="k">eval-when</span><span class="w"> </span><span class="p">(</span><span class="ss">:compile-toplevel</span><span class="w"> </span><span class="ss">:load-toplevel</span><span class="w"> </span><span class="ss">:execute</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="reader">
<span id="reader-2"></span><h2><code class="docutils literal notranslate"><span class="pre">|#&quot;-reader|</span></code><a class="headerlink" href="#reader" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">|#&quot;-reader|</span><span class="w"> </span><span class="p">(</span><span class="nc">stream</span><span class="w"> </span><span class="nv">sub-char</span><span class="w"> </span><span class="nv">numarg</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="k">declare</span><span class="w"> </span><span class="p">(</span><span class="k">ignore</span><span class="w"> </span><span class="nv">sub-char</span><span class="w"> </span><span class="nv">numarg</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 3</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">(</span><span class="nv">chars</span><span class="w"> </span><span class="p">(</span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;normal</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">depth</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">    </span><span class="p">(</span><span class="nb">loop</span><span class="w"> </span><span class="nb">do</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">        </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">curr</span><span class="w"> </span><span class="p">(</span><span class="nb">read-char</span><span class="w"> </span><span class="nc">stream</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">            </span><span class="p">(</span><span class="nb">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">eq</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;normal</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">                </span><span class="p">(</span><span class="nb">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">char=</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="sc">#\#</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">                        </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="sc">#\#</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">                        </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;read-sharp</span><span class="p">))</span><span class="w"></span>
<span class="linenos">10</span><span class="w">                        </span><span class="p">((</span><span class="nb">char=</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="sc">#\&quot;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">11</span><span class="w">                        </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;read-quote</span><span class="p">))</span><span class="w"></span>
<span class="linenos">12</span><span class="w">                        </span><span class="p">(</span><span class="no">t</span><span class="w"></span>
<span class="linenos">13</span><span class="w">                        </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="nv">chars</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">14</span><span class="w">                </span><span class="p">((</span><span class="nb">eq</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;read-sharp</span><span class="p">)</span><span class="w"></span>
<span class="linenos">15</span><span class="w">                </span><span class="p">(</span><span class="nb">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">char=</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="sc">#\&quot;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">16</span><span class="w">                        </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="sc">#\&quot;</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"></span>
<span class="linenos">17</span><span class="w">                        </span><span class="p">(</span><span class="nb">incf</span><span class="w"> </span><span class="nv">depth</span><span class="p">)</span><span class="w"></span>
<span class="linenos">18</span><span class="w">                        </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;normal</span><span class="p">))</span><span class="w"></span>
<span class="linenos">19</span><span class="w">                        </span><span class="p">(</span><span class="no">t</span><span class="w"></span>
<span class="linenos">20</span><span class="w">                        </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"></span>
<span class="linenos">21</span><span class="w">                        </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;normal</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">22</span><span class="w">                </span><span class="p">((</span><span class="nb">eq</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;read-quote</span><span class="p">)</span><span class="w"></span>
<span class="linenos">23</span><span class="w">                </span><span class="p">(</span><span class="nb">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">char=</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="sc">#\#</span><span class="p">)</span><span class="w"></span>
<span class="linenos">24</span><span class="w">                        </span><span class="p">(</span><span class="nb">decf</span><span class="w"> </span><span class="nv">depth</span><span class="p">)</span><span class="w"></span>
<span class="linenos">25</span><span class="w">                        </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">zerop</span><span class="w"> </span><span class="nv">depth</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">return</span><span class="p">))</span><span class="w"></span>
<span class="linenos">26</span><span class="w">                        </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="sc">#\&quot;</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"></span>
<span class="linenos">27</span><span class="w">                        </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="sc">#\#</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"></span>
<span class="linenos">28</span><span class="w">                        </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;normal</span><span class="p">))</span><span class="w"></span>
<span class="linenos">29</span><span class="w">                        </span><span class="p">(</span><span class="no">t</span><span class="w"></span>
<span class="linenos">30</span><span class="w">                        </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="sc">#\&quot;</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"></span>
<span class="linenos">31</span><span class="w">                        </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">char=</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="sc">#\&quot;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">32</span><span class="w">                            </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;read-quote</span><span class="p">)</span><span class="w"></span>
<span class="linenos">33</span><span class="w">                            </span><span class="p">(</span><span class="k">progn</span><span class="w"></span>
<span class="linenos">34</span><span class="w">                                </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"></span>
<span class="linenos">35</span><span class="w">                                </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">state</span><span class="w"> </span><span class="ss">&#39;normal</span><span class="p">)))))))))</span><span class="w"></span>
<span class="linenos">36</span><span class="w">    </span><span class="p">(</span><span class="nb">coerce</span><span class="w"> </span><span class="p">(</span><span class="nb">nreverse</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"> </span><span class="ss">&#39;string</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">37</span>
<span class="linenos">38</span><span class="c1">; (set-dispatch-macro-character #\# #\&quot; #&#39;|#&quot;-reader|)</span><span class="w"></span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="c1">; This version is from Martin Dirichs</span><span class="w"></span>
<span class="linenos">41</span><span class="p">(</span><span class="k">eval-when</span><span class="w"> </span><span class="p">(</span><span class="ss">:compile-toplevel</span><span class="w"> </span><span class="ss">:load-toplevel</span><span class="w"> </span><span class="ss">:execute</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id8">
<span id="id9"></span><h2><code class="docutils literal notranslate"><span class="pre">|#&gt;-reader|</span></code><a class="headerlink" href="#id8" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">|#&gt;-reader|</span><span class="w"> </span><span class="p">(</span><span class="nc">stream</span><span class="w"> </span><span class="nv">sub-char</span><span class="w"> </span><span class="nv">numarg</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w">    </span><span class="p">(</span><span class="k">declare</span><span class="w"> </span><span class="p">(</span><span class="k">ignore</span><span class="w"> </span><span class="nv">sub-char</span><span class="w"> </span><span class="nv">numarg</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">(</span><span class="nv">chars</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">    </span><span class="p">(</span><span class="nb">do</span><span class="w"> </span><span class="p">((</span><span class="nv">curr</span><span class="w"> </span><span class="p">(</span><span class="nb">read-char</span><span class="w"> </span><span class="nc">stream</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">                </span><span class="p">(</span><span class="nb">read-char</span><span class="w"> </span><span class="nc">stream</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">        </span><span class="p">((</span><span class="nb">char=</span><span class="w"> </span><span class="sc">#\newline</span><span class="w"> </span><span class="nv">curr</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">        </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="nv">chars</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">pattern</span><span class="w"> </span><span class="p">(</span><span class="nb">nreverse</span><span class="w"> </span><span class="nv">chars</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">            </span><span class="nv">output</span><span class="p">)</span><span class="w"></span>
<span class="linenos">10</span><span class="w">        </span><span class="p">(</span><span class="k">labels</span><span class="w"> </span><span class="p">((</span><span class="nv">match</span><span class="w"> </span><span class="p">(</span><span class="nv">pos</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"></span>
<span class="linenos">11</span><span class="w">                </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">null</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"></span>
<span class="linenos">12</span><span class="w">                    </span><span class="nv">pos</span><span class="w"></span>
<span class="linenos">13</span><span class="w">                    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">char=</span><span class="w"> </span><span class="p">(</span><span class="nb">nth</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="nv">pattern</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">chars</span><span class="p">))</span><span class="w"></span>
<span class="linenos">14</span><span class="w">                        </span><span class="p">(</span><span class="nv">match</span><span class="w"> </span><span class="p">(</span><span class="nb">1+</span><span class="w"> </span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">chars</span><span class="p">))</span><span class="w"></span>
<span class="linenos">15</span><span class="w">                        </span><span class="p">(</span><span class="nv">match</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="p">(</span><span class="nb">append</span><span class="w"> </span><span class="p">(</span><span class="nb">subseq</span><span class="w"> </span><span class="nv">pattern</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">pos</span><span class="p">)</span><span class="w"> </span><span class="nv">chars</span><span class="p">)))))))</span><span class="w"></span>
<span class="linenos">16</span><span class="w">        </span><span class="p">(</span><span class="nb">do</span><span class="w"> </span><span class="p">(</span><span class="nv">curr</span><span class="w"></span>
<span class="linenos">17</span><span class="w">            </span><span class="p">(</span><span class="nv">pos</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span><span class="w"></span>
<span class="linenos">18</span><span class="w">            </span><span class="p">((</span><span class="nb">=</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="nv">pattern</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">19</span><span class="w">            </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="p">(</span><span class="nb">read-char</span><span class="w"> </span><span class="nc">stream</span><span class="p">)</span><span class="w"></span>
<span class="linenos">20</span><span class="w">                </span><span class="nv">pos</span><span class="w"> </span><span class="p">(</span><span class="nv">match</span><span class="w"> </span><span class="nv">pos</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="nv">curr</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">21</span><span class="w">            </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="nv">output</span><span class="p">))</span><span class="w"></span>
<span class="linenos">22</span><span class="w">        </span><span class="p">(</span><span class="nb">coerce</span><span class="w"></span>
<span class="linenos">23</span><span class="w">        </span><span class="p">(</span><span class="nb">nreverse</span><span class="w"></span>
<span class="linenos">24</span><span class="w">            </span><span class="p">(</span><span class="nb">nthcdr</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="nv">pattern</span><span class="p">)</span><span class="w"> </span><span class="nv">output</span><span class="p">))</span><span class="w"></span>
<span class="linenos">25</span><span class="w">        </span><span class="ss">&#39;string</span><span class="p">))))))</span><span class="w"></span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="c1">; (set-dispatch-macro-character #\# #\&gt; #&#39;|#&gt;-reader|)</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="segment-reader">
<span id="segment-reader2"></span><h2><code class="docutils literal notranslate"><span class="pre">segment-reader</span></code><a class="headerlink" href="#segment-reader" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">segment-reader</span><span class="w"> </span><span class="p">(</span><span class="nc">stream</span><span class="w"> </span><span class="nv">ch</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">chars</span><span class="p">))</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="p">(</span><span class="nb">do</span><span class="w"> </span><span class="p">((</span><span class="nv">curr</span><span class="w"> </span><span class="p">(</span><span class="nb">read-char</span><span class="w"> </span><span class="nc">stream</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5</span><span class="w">                </span><span class="p">(</span><span class="nb">read-char</span><span class="w"> </span><span class="nc">stream</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">6</span><span class="w">        </span><span class="p">((</span><span class="nb">char=</span><span class="w"> </span><span class="nv">ch</span><span class="w"> </span><span class="nv">curr</span><span class="p">))</span><span class="w"></span>
<span class="linenos">7</span><span class="w">        </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="nv">curr</span><span class="w"> </span><span class="nv">chars</span><span class="p">))</span><span class="w"></span>
<span class="linenos">8</span><span class="w">    </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nb">coerce</span><span class="w"> </span><span class="p">(</span><span class="nb">nreverse</span><span class="w"> </span><span class="nv">chars</span><span class="p">)</span><span class="w"> </span><span class="ss">&#39;string</span><span class="p">)</span><span class="w"></span>
<span class="linenos">9</span><span class="w">            </span><span class="p">(</span><span class="nv">segment-reader</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="nv">ch</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="mi">1</span><span class="p">))))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="match-mode-ppcre-lambda-form">
<span id="match-mode-ppcre-lambda-form2"></span><h2><code class="docutils literal notranslate"><span class="pre">match-mode-ppcre-lambda-form</span></code><a class="headerlink" href="#match-mode-ppcre-lambda-form" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="o">#+</span><span class="nv">cl-ppcre</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="nv">defmacro!</span><span class="w"> </span><span class="nv">match-mode-ppcre-lambda-form</span><span class="w"> </span><span class="p">(</span><span class="nv">o!args</span><span class="w"> </span><span class="nv">o!mods</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 3</span><span class="o">``</span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="o">,</span><span class="ss">&#39;,g!str</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">    </span><span class="p">(</span><span class="nv">ppcre:scan-to-strings</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">    </span><span class="o">,</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">zerop</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="o">,</span><span class="nv">g!mods</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">        </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="o">,</span><span class="nv">g!args</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">        </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="s">&quot;(?~a)~a&quot;</span><span class="w"> </span><span class="o">,</span><span class="nv">g!mods</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="o">,</span><span class="nv">g!args</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">    </span><span class="o">,</span><span class="ss">&#39;,g!str</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="o">#+</span><span class="nv">cl-ppcre</span><span class="w"></span>
<span class="linenos">11</span><span class="p">(</span><span class="nv">defmacro!</span><span class="w"> </span><span class="nv">subst-mode-ppcre-lambda-form</span><span class="w"> </span><span class="p">(</span><span class="nv">o!args</span><span class="p">)</span><span class="w"></span>
<span class="linenos">12</span><span class="o">``</span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="o">,</span><span class="ss">&#39;,g!str</span><span class="p">)</span><span class="w"></span>
<span class="linenos">13</span><span class="w">    </span><span class="p">(</span><span class="nv">cl-ppcre:regex-replace-all</span><span class="w"></span>
<span class="linenos">14</span><span class="w">    </span><span class="o">,</span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="o">,</span><span class="nv">g!args</span><span class="p">)</span><span class="w"></span>
<span class="linenos">15</span><span class="w">    </span><span class="o">,</span><span class="ss">&#39;,g!str</span><span class="w"></span>
<span class="linenos">16</span><span class="w">    </span><span class="o">,</span><span class="p">(</span><span class="nb">cadr</span><span class="w"> </span><span class="o">,</span><span class="nv">g!args</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id10">
<span id="id11"></span><h2><code class="docutils literal notranslate"><span class="pre">|#~-reader|</span></code><a class="headerlink" href="#id10" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="o">#+</span><span class="nv">cl-ppcre</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="k">eval-when</span><span class="w"> </span><span class="p">(</span><span class="ss">:compile-toplevel</span><span class="w"> </span><span class="ss">:load-toplevel</span><span class="w"> </span><span class="ss">:execute</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 3</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">|#~-reader|</span><span class="w"> </span><span class="p">(</span><span class="nc">stream</span><span class="w"> </span><span class="nv">sub-char</span><span class="w"> </span><span class="nv">numarg</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">    </span><span class="p">(</span><span class="k">declare</span><span class="w"> </span><span class="p">(</span><span class="k">ignore</span><span class="w"> </span><span class="nv">sub-char</span><span class="w"> </span><span class="nv">numarg</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">mode-char</span><span class="w"> </span><span class="p">(</span><span class="nb">read-char</span><span class="w"> </span><span class="nc">stream</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p">(</span><span class="nb">cond</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">        </span><span class="p">((</span><span class="nb">char=</span><span class="w"> </span><span class="nv">mode-char</span><span class="w"> </span><span class="sc">#\m</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">        </span><span class="p">(</span><span class="nv">match-mode-ppcre-lambda-form</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">        </span><span class="p">(</span><span class="nv">segment-reader</span><span class="w"> </span><span class="nc">stream</span><span class="w"></span>
<span class="linenos">10</span><span class="w">                        </span><span class="p">(</span><span class="nb">read-char</span><span class="w"> </span><span class="nc">stream</span><span class="p">)</span><span class="w"></span>
<span class="linenos">11</span><span class="w">                        </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">12</span><span class="w">        </span><span class="p">(</span><span class="nb">coerce</span><span class="w"> </span><span class="p">(</span><span class="nb">loop</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">read-char</span><span class="w"> </span><span class="nc">stream</span><span class="p">)</span><span class="w"></span>
<span class="linenos">13</span><span class="w">                    </span><span class="nv">while</span><span class="w"> </span><span class="p">(</span><span class="nb">alpha-char-p</span><span class="w"> </span><span class="nv">c</span><span class="p">)</span><span class="w"></span>
<span class="linenos">14</span><span class="w">                    </span><span class="nv">collect</span><span class="w"> </span><span class="nv">c</span><span class="w"></span>
<span class="linenos">15</span><span class="w">                    </span><span class="nv">finally</span><span class="w"> </span><span class="p">(</span><span class="nb">unread-char</span><span class="w"> </span><span class="nv">c</span><span class="w"> </span><span class="nc">stream</span><span class="p">))</span><span class="w"></span>
<span class="linenos">16</span><span class="w">                </span><span class="ss">&#39;string</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">17</span><span class="w">        </span><span class="p">((</span><span class="nb">char=</span><span class="w"> </span><span class="nv">mode-char</span><span class="w"> </span><span class="sc">#\s</span><span class="p">)</span><span class="w"></span>
<span class="linenos">18</span><span class="w">        </span><span class="p">(</span><span class="nv">subst-mode-ppcre-lambda-form</span><span class="w"></span>
<span class="linenos">19</span><span class="w">        </span><span class="p">(</span><span class="nv">segment-reader</span><span class="w"> </span><span class="nc">stream</span><span class="w"></span>
<span class="linenos">20</span><span class="w">                        </span><span class="p">(</span><span class="nb">read-char</span><span class="w"> </span><span class="nc">stream</span><span class="p">)</span><span class="w"></span>
<span class="linenos">21</span><span class="w">                        </span><span class="mi">2</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">22</span><span class="w">        </span><span class="p">(</span><span class="no">t</span><span class="w"> </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="s">&quot;Unknown #~~ mode character&quot;</span><span class="p">))))))</span><span class="w"></span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="c1">; #+cl-ppcre (set-dispatch-macro-character #\# #\~ #&#39;|#~-reader|)</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="dlambda">
<span id="dlambda2"></span><h2><code class="docutils literal notranslate"><span class="pre">dlambda</span></code><a class="headerlink" href="#dlambda" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nv">defmacro!</span><span class="w"> </span><span class="nv">dlambda</span><span class="w"> </span><span class="p">(</span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">ds</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="o">`</span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="k">&amp;rest</span><span class="w"> </span><span class="o">,</span><span class="nv">g!args</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">    </span><span class="p">(</span><span class="nb">case</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="o">,</span><span class="nv">g!args</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">    </span><span class="o">,@</span><span class="p">(</span><span class="nb">mapcar</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">        </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="nv">d</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">            </span><span class="o">`</span><span class="p">(</span><span class="o">,</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">d</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">                </span><span class="no">t</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">                </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">d</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">            </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="o">,@</span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">d</span><span class="p">))</span><span class="w"></span>
<span class="linenos">10</span><span class="w">                    </span><span class="o">,</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">eq</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">d</span><span class="p">))</span><span class="w"></span>
<span class="linenos">11</span><span class="w">                        </span><span class="nv">g!args</span><span class="w"></span>
<span class="linenos">12</span><span class="w">                        </span><span class="o">`</span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="o">,</span><span class="nv">g!args</span><span class="p">)))))</span><span class="w"></span>
<span class="linenos">13</span><span class="w">        </span><span class="nv">ds</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="alambda">
<span id="alambda2"></span><h2><code class="docutils literal notranslate"><span class="pre">alambda</span></code><a class="headerlink" href="#alambda" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">;; Graham&#39;s alambda</span><span class="w"></span>
<span class="linenos">2</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">alambda</span><span class="w"> </span><span class="p">(</span><span class="nv">parms</span><span class="w"> </span><span class="k">&amp;body</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="o">`</span><span class="p">(</span><span class="k">labels</span><span class="w"> </span><span class="p">((</span><span class="nv">self</span><span class="w"> </span><span class="o">,</span><span class="nv">parms</span><span class="w"> </span><span class="o">,@</span><span class="nv">body</span><span class="p">))</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="nf">#&#39;</span><span class="nv">self</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="aif">
<span id="aif2"></span><h2><code class="docutils literal notranslate"><span class="pre">aif</span></code><a class="headerlink" href="#aif" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">;; Graham&#39;s aif</span><span class="w"></span>
<span class="linenos">2</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">aif</span><span class="w"> </span><span class="p">(</span><span class="nv">test</span><span class="w"> </span><span class="nv">then</span><span class="w"> </span><span class="k">&amp;optional</span><span class="w"> </span><span class="nv">else</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="o">`</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">it</span><span class="w"> </span><span class="o">,</span><span class="nv">test</span><span class="p">))</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="o">,</span><span class="nv">then</span><span class="w"> </span><span class="o">,</span><span class="nv">else</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id12">
<span id="id13"></span><h2><code class="docutils literal notranslate"><span class="pre">|#`-reader|</span></code><a class="headerlink" href="#id12" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="k">eval-when</span><span class="w"> </span><span class="p">(</span><span class="ss">:compile-toplevel</span><span class="w"> </span><span class="ss">:execute</span><span class="w"> </span><span class="ss">:load-toplevel</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">|#`-reader|</span><span class="w"> </span><span class="p">(</span><span class="nc">stream</span><span class="w"> </span><span class="nv">sub-char</span><span class="w"> </span><span class="nv">numarg</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="k">declare</span><span class="w"> </span><span class="p">(</span><span class="k">ignore</span><span class="w"> </span><span class="nv">sub-char</span><span class="p">))</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="p">(</span><span class="nb">unless</span><span class="w"> </span><span class="nv">numarg</span><span class="w"> </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">numarg</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="o">`</span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="o">,</span><span class="p">(</span><span class="nb">loop</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">numarg</span><span class="w"></span>
<span class="linenos">6</span><span class="w">                </span><span class="nv">collect</span><span class="w"> </span><span class="p">(</span><span class="nv">symb</span><span class="w"> </span><span class="ss">&#39;a</span><span class="w"> </span><span class="nv">i</span><span class="p">))</span><span class="w"></span>
<span class="linenos">7</span><span class="w">    </span><span class="o">,</span><span class="p">(</span><span class="nb">funcall</span><span class="w"></span>
<span class="linenos">8</span><span class="w">        </span><span class="p">(</span><span class="nb">get-macro-character</span><span class="w"> </span><span class="sc">#\`</span><span class="p">)</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="no">nil</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="f-reader">
<span id="f-reader-2"></span><h2><code class="docutils literal notranslate"><span class="pre">|#f-reader|</span></code><a class="headerlink" href="#f-reader" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">|#f-reader|</span><span class="w"> </span><span class="p">(</span><span class="nc">stream</span><span class="w"> </span><span class="nv">sub-char</span><span class="w"> </span><span class="nv">numarg</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="p">(</span><span class="k">declare</span><span class="w"> </span><span class="p">(</span><span class="k">ignore</span><span class="w"> </span><span class="nc">stream</span><span class="w"> </span><span class="nv">sub-char</span><span class="p">))</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">numarg</span><span class="w"> </span><span class="p">(</span><span class="nb">or</span><span class="w"> </span><span class="nv">numarg</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="p">(</span><span class="nb">unless</span><span class="w"> </span><span class="p">(</span><span class="nb">&lt;=</span><span class="w"> </span><span class="nv">numarg</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="s">&quot;Bad value for #f: ~a&quot;</span><span class="w"> </span><span class="nv">numarg</span><span class="p">))</span><span class="w"></span>
<span class="linenos">6</span><span class="w">    </span><span class="o">`</span><span class="p">(</span><span class="k">declare</span><span class="w"> </span><span class="p">(</span><span class="k">optimize</span><span class="w"> </span><span class="p">(</span><span class="nv">speed</span><span class="w"> </span><span class="o">,</span><span class="nv">numarg</span><span class="p">)</span><span class="w"></span>
<span class="linenos">7</span><span class="w">                        </span><span class="p">(</span><span class="nv">safety</span><span class="w"> </span><span class="o">,</span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">numarg</span><span class="p">)))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="lol-syntax">
<span id="lol-syntax2"></span><h2><code class="docutils literal notranslate"><span class="pre">lol-syntax</span></code><a class="headerlink" href="#lol-syntax" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nv">defreadtable</span><span class="w"> </span><span class="nv">lol-syntax</span><span class="w"></span>
<span class="linenos">2</span><span class="w">    </span><span class="p">(</span><span class="ss">:merge</span><span class="w"> </span><span class="ss">:standard</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="ss">:dispatch-macro-char</span><span class="w"> </span><span class="sc">#\#</span><span class="w"> </span><span class="sc">#\&quot;</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">|#&quot;-reader|</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="p">(</span><span class="ss">:dispatch-macro-char</span><span class="w"> </span><span class="sc">#\#</span><span class="w"> </span><span class="sc">#\&gt;</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">|#&gt;-reader|</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="o">#+</span><span class="nv">cl-ppcre</span><span class="w"></span>
<span class="linenos">6</span><span class="w">    </span><span class="p">(</span><span class="ss">:dispatch-macro-char</span><span class="w"> </span><span class="sc">#\#</span><span class="w"> </span><span class="sc">#\~</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">|#~-reader|</span><span class="p">)</span><span class="w"></span>
<span class="linenos">7</span><span class="w">    </span><span class="p">(</span><span class="ss">:dispatch-macro-char</span><span class="w"> </span><span class="sc">#\#</span><span class="w"> </span><span class="sc">#\`</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">|#`-reader|</span><span class="p">)</span><span class="w"></span>
<span class="linenos">8</span><span class="w">    </span><span class="p">(</span><span class="ss">:dispatch-macro-char</span><span class="w"> </span><span class="sc">#\#</span><span class="w"> </span><span class="sc">#\f</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">|#f-reader|</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="nlet-tail">
<span id="nlet-tail2"></span><h2><code class="docutils literal notranslate"><span class="pre">nlet-tail</span></code><a class="headerlink" href="#nlet-tail" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nv">in-readtable</span><span class="w"> </span><span class="nv">lol-syntax</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="p">(</span><span class="nv">defmacro!</span><span class="w"> </span><span class="nv">nlet-tail</span><span class="w"> </span><span class="p">(</span><span class="nv">n</span><span class="w"> </span><span class="nv">letargs</span><span class="w"> </span><span class="k">&amp;body</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">gs</span><span class="w"> </span><span class="p">(</span><span class="nb">loop</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">letargs</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">            </span><span class="nv">collect</span><span class="w"> </span><span class="p">(</span><span class="nb">gensym</span><span class="p">))))</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">    </span><span class="o">`</span><span class="p">(</span><span class="k">macrolet</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">        </span><span class="p">((</span><span class="o">,</span><span class="nv">n</span><span class="w"> </span><span class="o">,</span><span class="nv">gs</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">            </span><span class="o">`</span><span class="p">(</span><span class="k">progn</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">            </span><span class="p">(</span><span class="nb">psetq</span><span class="w"></span>
<span class="linenos">10</span><span class="w">                </span><span class="o">,@</span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nb">nconc</span><span class="w"></span>
<span class="linenos">11</span><span class="w">                        </span><span class="p">(</span><span class="nb">mapcar</span><span class="w"></span>
<span class="linenos">12</span><span class="w">                        </span><span class="nf">#&#39;</span><span class="nb">list</span><span class="w"></span>
<span class="linenos">13</span><span class="w">                        </span><span class="ss">&#39;,</span><span class="p">(</span><span class="nb">mapcar</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nb">car</span><span class="w"> </span><span class="nv">letargs</span><span class="p">)</span><span class="w"></span>
<span class="linenos">14</span><span class="w">                        </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="o">,@</span><span class="nv">gs</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">15</span><span class="w">            </span><span class="p">(</span><span class="k">go</span><span class="w"> </span><span class="o">,</span><span class="ss">&#39;,g!n</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">16</span><span class="w">    </span><span class="p">(</span><span class="k">block</span><span class="w"> </span><span class="o">,</span><span class="nv">g!b</span><span class="w"></span>
<span class="linenos">17</span><span class="w">        </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="o">,</span><span class="nv">letargs</span><span class="w"></span>
<span class="linenos">18</span><span class="w">        </span><span class="p">(</span><span class="k">tagbody</span><span class="w"></span>
<span class="linenos">19</span><span class="w">            </span><span class="o">,</span><span class="nv">g!n</span><span class="w"> </span><span class="p">(</span><span class="k">return-from</span><span class="w"></span>
<span class="linenos">20</span><span class="w">                    </span><span class="o">,</span><span class="nv">g!b</span><span class="w"> </span><span class="p">(</span><span class="k">progn</span><span class="w"> </span><span class="o">,@</span><span class="nv">body</span><span class="p">))))))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="alet">
<span id="alet-s2"></span><h2><code class="docutils literal notranslate"><span class="pre">alet%</span></code><a class="headerlink" href="#alet" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">alet%</span><span class="w"> </span><span class="p">(</span><span class="nv">letargs</span><span class="w"> </span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="o">`</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">this</span><span class="p">)</span><span class="w"> </span><span class="o">,@</span><span class="nv">letargs</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="o">,@</span><span class="p">(</span><span class="nb">last</span><span class="w"> </span><span class="nv">body</span><span class="p">))</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="o">,@</span><span class="p">(</span><span class="nb">butlast</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="nv">this</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="alet2">
<span id="id14"></span><h2><code class="docutils literal notranslate"><span class="pre">alet</span></code><a class="headerlink" href="#alet2" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">alet</span><span class="w"> </span><span class="p">(</span><span class="nv">letargs</span><span class="w"> </span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="o">`</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">this</span><span class="p">)</span><span class="w"> </span><span class="o">,@</span><span class="nv">letargs</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="o">,@</span><span class="p">(</span><span class="nb">last</span><span class="w"> </span><span class="nv">body</span><span class="p">))</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="o">,@</span><span class="p">(</span><span class="nb">butlast</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="p">(</span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">params</span><span class="p">)</span><span class="w"></span>
<span class="linenos">6</span><span class="w">    </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">params</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="let-binding-transform">
<span id="let-binding-transform2"></span><h2><code class="docutils literal notranslate"><span class="pre">let-binding-transform</span></code><a class="headerlink" href="#let-binding-transform" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">let-binding-transform</span><span class="w"> </span><span class="p">(</span><span class="nv">bs</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">bs</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">    </span><span class="p">(</span><span class="nb">cons</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">    </span><span class="p">(</span><span class="nb">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">symbolp</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">bs</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">            </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">bs</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">            </span><span class="p">((</span><span class="nb">consp</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">bs</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">            </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">bs</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">            </span><span class="p">(</span><span class="no">t</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">            </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="s">&quot;Bad let bindings&quot;</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">10</span><span class="w">    </span><span class="p">(</span><span class="nv">let-binding-transform</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">bs</span><span class="p">)))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pandoriclet">
<span id="pandoriclet2"></span><h2><code class="docutils literal notranslate"><span class="pre">pandoriclet</span></code><a class="headerlink" href="#pandoriclet" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">pandoriclet</span><span class="w"> </span><span class="p">(</span><span class="nv">letargs</span><span class="w"> </span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">letargs</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">                </span><span class="o">&#39;</span><span class="p">(</span><span class="nv">this</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">                </span><span class="p">(</span><span class="nv">let-binding-transform</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">                    </span><span class="nv">letargs</span><span class="p">))))</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">    </span><span class="o">`</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">(</span><span class="o">,@</span><span class="nv">letargs</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">    </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="o">,@</span><span class="p">(</span><span class="nb">last</span><span class="w"> </span><span class="nv">body</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">    </span><span class="o">,@</span><span class="p">(</span><span class="nb">butlast</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">    </span><span class="p">(</span><span class="nv">dlambda</span><span class="w"></span>
<span class="linenos">10</span><span class="w">        </span><span class="p">(</span><span class="ss">:pandoric-get</span><span class="w"> </span><span class="p">(</span><span class="nv">sym</span><span class="p">)</span><span class="w"></span>
<span class="linenos">11</span><span class="w">        </span><span class="o">,</span><span class="p">(</span><span class="nv">pandoriclet-get</span><span class="w"> </span><span class="nv">letargs</span><span class="p">))</span><span class="w"></span>
<span class="linenos">12</span><span class="w">        </span><span class="p">(</span><span class="ss">:pandoric-set</span><span class="w"> </span><span class="p">(</span><span class="nv">sym</span><span class="w"> </span><span class="nv">val</span><span class="p">)</span><span class="w"></span>
<span class="linenos">13</span><span class="w">        </span><span class="o">,</span><span class="p">(</span><span class="nv">pandoriclet-set</span><span class="w"> </span><span class="nv">letargs</span><span class="p">))</span><span class="w"></span>
<span class="linenos">14</span><span class="w">        </span><span class="p">(</span><span class="no">t</span><span class="w"> </span><span class="p">(</span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">args</span><span class="p">)</span><span class="w"></span>
<span class="linenos">15</span><span class="w">        </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">args</span><span class="p">))))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pandoriclet-get">
<span id="pandoriclet-get2"></span><h2><code class="docutils literal notranslate"><span class="pre">pandoriclet-get</span></code><a class="headerlink" href="#pandoriclet-get" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>(defun pandoriclet-get (letargs)
<span class="linenos">2</span>`(case sym
<span class="linenos">3</span>    ,@(mapcar #`((,(car a1)) ,(car a1))
<span class="linenos">4</span>            letargs)
<span class="linenos">5</span>    (t (error
<span class="linenos">6</span>        &quot;Unknown pandoric get: ~a&quot;
<span class="linenos">7</span>        sym))))
</pre></div>
</div>
</section>
<section id="pandoriclet-set">
<span id="pandoriclet-set2"></span><h2><code class="docutils literal notranslate"><span class="pre">pandoriclet-set</span></code><a class="headerlink" href="#pandoriclet-set" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>(defun pandoriclet-set (letargs)
<span class="linenos">2</span>`(case sym
<span class="linenos">3</span>    ,@(mapcar #`((,(car a1))
<span class="linenos">4</span>                (setq ,(car a1) val))
<span class="linenos">5</span>            letargs)
<span class="linenos">6</span>    (t (error
<span class="linenos">7</span>        &quot;Unknown pandoric set: ~a&quot;
<span class="linenos">8</span>        sym))))
</pre></div>
</div>
</section>
<section id="get-pandoric">
<span id="get-pandoric2"></span><h2><code class="docutils literal notranslate"><span class="pre">get-pandoric</span></code><a class="headerlink" href="#get-pandoric" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">declaim</span><span class="w"> </span><span class="p">(</span><span class="k">inline</span><span class="w"> </span><span class="nv">get-pandoric</span><span class="p">))</span><span class="w"></span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">get-pandoric</span><span class="w"> </span><span class="p">(</span><span class="nv">box</span><span class="w"> </span><span class="nv">sym</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4</span><span class="p">(</span><span class="nb">funcall</span><span class="w"> </span><span class="nv">box</span><span class="w"> </span><span class="ss">:pandoric-get</span><span class="w"> </span><span class="nv">sym</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id15">
<span id="id16"></span><h2><code class="docutils literal notranslate"><span class="pre">get-pandoric</span></code><a class="headerlink" href="#id15" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defsetf</span><span class="w"> </span><span class="nv">get-pandoric</span><span class="w"> </span><span class="p">(</span><span class="nv">box</span><span class="w"> </span><span class="nv">sym</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">val</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="o">`</span><span class="p">(</span><span class="k">progn</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="nb">funcall</span><span class="w"> </span><span class="o">,</span><span class="nv">box</span><span class="w"> </span><span class="ss">:pandoric-set</span><span class="w"> </span><span class="o">,</span><span class="nv">sym</span><span class="w"> </span><span class="o">,</span><span class="nv">val</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="o">,</span><span class="nv">val</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="with-pandoric">
<span id="with-pandoric2"></span><h2><code class="docutils literal notranslate"><span class="pre">with-pandoric</span></code><a class="headerlink" href="#with-pandoric" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>(defmacro with-pandoric (syms box &amp;rest body)
<span class="linenos">2</span>(let ((g!box (gensym &quot;box&quot;)))
<span class="linenos">3</span>    `(let ((,g!box ,box))
<span class="linenos">4</span>    (declare (ignorable ,g!box))
<span class="linenos">5</span>    (symbol-macrolet
<span class="linenos">6</span>        (,@(mapcar #`(,a1 (get-pandoric ,g!box &#39;,a1))
<span class="linenos">7</span>                    syms))
<span class="linenos">8</span>        ,@body))))
</pre></div>
</div>
</section>
<section id="pandoric-hotpatch">
<span id="pandoric-hotpatch2"></span><h2><code class="docutils literal notranslate"><span class="pre">pandoric-hotpatch</span></code><a class="headerlink" href="#pandoric-hotpatch" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">pandoric-hotpatch</span><span class="w"> </span><span class="p">(</span><span class="nv">box</span><span class="w"> </span><span class="nv">new</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="p">(</span><span class="nv">with-pandoric</span><span class="w"> </span><span class="p">(</span><span class="nv">this</span><span class="p">)</span><span class="w"> </span><span class="nv">box</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">new</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pandoric-recode">
<span id="pandoric-recode2"></span><h2><code class="docutils literal notranslate"><span class="pre">pandoric-recode</span></code><a class="headerlink" href="#pandoric-recode" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">pandoric-recode</span><span class="w"> </span><span class="p">(</span><span class="nv">vars</span><span class="w"> </span><span class="nv">box</span><span class="w"> </span><span class="nv">new</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="o">`</span><span class="p">(</span><span class="nv">with-pandoric</span><span class="w"> </span><span class="p">(</span><span class="nv">this</span><span class="w"> </span><span class="o">,@</span><span class="nv">vars</span><span class="p">)</span><span class="w"> </span><span class="o">,</span><span class="nv">box</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="k">setq</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="o">,</span><span class="nv">new</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="plambda">
<span id="plambda2"></span><h2><code class="docutils literal notranslate"><span class="pre">plambda</span></code><a class="headerlink" href="#plambda" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">plambda</span><span class="w"> </span><span class="p">(</span><span class="nv">largs</span><span class="w"> </span><span class="nv">pargs</span><span class="w"> </span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">pargs</span><span class="w"> </span><span class="p">(</span><span class="nb">mapcar</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nb">list</span><span class="w"> </span><span class="nv">pargs</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">    </span><span class="o">`</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">(</span><span class="nv">this</span><span class="w"> </span><span class="nv">self</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">    </span><span class="p">(</span><span class="k">setq</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">        </span><span class="nv">this</span><span class="w"> </span><span class="p">(</span><span class="k">lambda</span><span class="w"> </span><span class="o">,</span><span class="nv">largs</span><span class="w"> </span><span class="o">,@</span><span class="nv">body</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">        </span><span class="nv">self</span><span class="w"> </span><span class="p">(</span><span class="nv">dlambda</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">                </span><span class="p">(</span><span class="ss">:pandoric-get</span><span class="w"> </span><span class="p">(</span><span class="nv">sym</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">                </span><span class="o">,</span><span class="p">(</span><span class="nv">pandoriclet-get</span><span class="w"> </span><span class="nv">pargs</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">                </span><span class="p">(</span><span class="ss">:pandoric-set</span><span class="w"> </span><span class="p">(</span><span class="nv">sym</span><span class="w"> </span><span class="nv">val</span><span class="p">)</span><span class="w"></span>
<span class="linenos">10</span><span class="w">                </span><span class="o">,</span><span class="p">(</span><span class="nv">pandoriclet-set</span><span class="w"> </span><span class="nv">pargs</span><span class="p">))</span><span class="w"></span>
<span class="linenos">11</span><span class="w">                </span><span class="p">(</span><span class="no">t</span><span class="w"> </span><span class="p">(</span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">args</span><span class="p">)</span><span class="w"></span>
<span class="linenos">12</span><span class="w">                </span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nv">this</span><span class="w"> </span><span class="nv">args</span><span class="p">)))))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pandoric-eval-tunnel">
<span id="pandoric-eval-tunnel2"></span><h2><code class="docutils literal notranslate"><span class="pre">pandoric-eval-tunnel</span></code><a class="headerlink" href="#pandoric-eval-tunnel" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defvar</span><span class="w"> </span><span class="nv">pandoric-eval-tunnel</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="pandoric-eval">
<span id="pandoric-eval2"></span><h2><code class="docutils literal notranslate"><span class="pre">pandoric-eval</span></code><a class="headerlink" href="#pandoric-eval" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">pandoric-eval</span><span class="w"> </span><span class="p">(</span><span class="nv">vars</span><span class="w"> </span><span class="nv">expr</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="o">`</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">pandoric-eval-tunnel</span><span class="w"></span>
<span class="linenos">3</span><span class="w">        </span><span class="p">(</span><span class="nv">plambda</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">,</span><span class="nv">vars</span><span class="w"> </span><span class="no">t</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="p">(</span><span class="nb">eval</span><span class="w"> </span><span class="o">`</span><span class="p">(</span><span class="nv">with-pandoric</span><span class="w"></span>
<span class="linenos">5</span><span class="w">            </span><span class="o">,</span><span class="ss">&#39;,vars</span><span class="w"> </span><span class="nv">pandoric-eval-tunnel</span><span class="w"></span>
<span class="linenos">6</span><span class="w">            </span><span class="o">,,</span><span class="nv">expr</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">;; Chapter 7</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="fast-progn">
<span id="fast-progn2"></span><h2><code class="docutils literal notranslate"><span class="pre">fast-progn</span></code><a class="headerlink" href="#fast-progn" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>(defmacro fast-progn (&amp;rest body)
<span class="linenos">2</span>`(locally #f ,@body))
</pre></div>
</div>
</section>
<section id="safe-progn">
<span id="safe-progn2"></span><h2><code class="docutils literal notranslate"><span class="pre">safe-progn</span></code><a class="headerlink" href="#safe-progn" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>(defmacro safe-progn (&amp;rest body)
<span class="linenos">2</span>`(locally #0f ,@body))
</pre></div>
</div>
</section>
<section id="fformat">
<span id="fformat2"></span><h2><code class="docutils literal notranslate"><span class="pre">fformat</span></code><a class="headerlink" href="#fformat" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">fformat</span><span class="w"> </span><span class="p">(</span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">all</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="p">(</span><span class="nb">apply</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nb">format</span><span class="w"> </span><span class="nv">all</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="id17">
<span id="id18"></span><h2><code class="docutils literal notranslate"><span class="pre">fformat</span></code><a class="headerlink" href="#id17" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">define-compiler-macro</span><span class="w"> </span><span class="nv">fformat</span><span class="w"></span>
<span class="linenos"> 2</span><span class="w">                    </span><span class="p">(</span><span class="k">&amp;whole</span><span class="w"> </span><span class="nv">form</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">                        </span><span class="nc">stream</span><span class="w"> </span><span class="nv">fmt</span><span class="w"> </span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">args</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">constantp</span><span class="w"> </span><span class="nv">fmt</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nc">stream</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">    </span><span class="o">`</span><span class="p">(</span><span class="nb">funcall</span><span class="w"> </span><span class="p">(</span><span class="nb">formatter</span><span class="w"> </span><span class="o">,</span><span class="nv">fmt</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">        </span><span class="o">,</span><span class="nc">stream</span><span class="w"> </span><span class="o">,@</span><span class="nv">args</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">g!stream</span><span class="w"> </span><span class="p">(</span><span class="nb">gensym</span><span class="w"> </span><span class="s">&quot;stream&quot;</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">        </span><span class="o">`</span><span class="p">(</span><span class="nb">with-output-to-string</span><span class="w"> </span><span class="p">(</span><span class="o">,</span><span class="nv">g!stream</span><span class="p">)</span><span class="w"></span>
<span class="linenos">10</span><span class="w">        </span><span class="p">(</span><span class="nb">funcall</span><span class="w"> </span><span class="p">(</span><span class="nb">formatter</span><span class="w"> </span><span class="o">,</span><span class="nv">fmt</span><span class="p">)</span><span class="w"></span>
<span class="linenos">11</span><span class="w">            </span><span class="o">,</span><span class="nv">g!stream</span><span class="w"> </span><span class="o">,@</span><span class="nv">args</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">12</span><span class="w">    </span><span class="nv">form</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="inline-make-tlist-tlist-left-tlist-right-tlist-empty-p">
<span id="inline-make-tlist-tlist-left-tlist-right-tlist-empty-p2"></span><h2><code class="docutils literal notranslate"><span class="pre">inline</span> <span class="pre">make-tlist</span> <span class="pre">tlist-left</span> <span class="pre">tlist-right</span> <span class="pre">tlist-empty-p</span></code><a class="headerlink" href="#inline-make-tlist-tlist-left-tlist-right-tlist-empty-p" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">declaim</span><span class="w"> </span><span class="p">(</span><span class="k">inline</span><span class="w"> </span><span class="nv">make-tlist</span><span class="w"> </span><span class="nv">tlist-left</span><span class="w"></span>
<span class="linenos">2</span><span class="w">                </span><span class="nv">tlist-right</span><span class="w"> </span><span class="nv">tlist-empty-p</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="make-tlist">
<span id="make-tlist2"></span><h2><code class="docutils literal notranslate"><span class="pre">make-tlist</span></code><a class="headerlink" href="#make-tlist" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">make-tlist</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="no">nil</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="tlist-left">
<span id="tlist-left2"></span><h2><code class="docutils literal notranslate"><span class="pre">tlist-left</span></code><a class="headerlink" href="#tlist-left" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">tlist-left</span><span class="w"> </span><span class="p">(</span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">caar</span><span class="w"> </span><span class="nv">tl</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="tlist-right">
<span id="tlist-right2"></span><h2><code class="docutils literal notranslate"><span class="pre">tlist-right</span></code><a class="headerlink" href="#tlist-right" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">tlist-right</span><span class="w"> </span><span class="p">(</span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">cadr</span><span class="w"> </span><span class="nv">tl</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="tlist-empty-p">
<span id="tlist-empty-p2"></span><h2><code class="docutils literal notranslate"><span class="pre">tlist-empty-p</span></code><a class="headerlink" href="#tlist-empty-p" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">tlist-empty-p</span><span class="w"> </span><span class="p">(</span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">null</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">tl</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="inline-tlist-add-left-tlist-add-right">
<span id="inline-tlist-add-left-tlist-add-right2"></span><h2><code class="docutils literal notranslate"><span class="pre">inline</span> <span class="pre">tlist-add-left</span> <span class="pre">tlist-add-right</span></code><a class="headerlink" href="#inline-tlist-add-left-tlist-add-right" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">declaim</span><span class="w"> </span><span class="p">(</span><span class="k">inline</span><span class="w"> </span><span class="nv">tlist-add-left</span><span class="w"></span>
<span class="linenos">2</span><span class="w">                </span><span class="nv">tlist-add-right</span><span class="p">))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="tlist-add-left">
<span id="tlist-add-left2"></span><h2><code class="docutils literal notranslate"><span class="pre">tlist-add-left</span></code><a class="headerlink" href="#tlist-add-left" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">tlist-add-left</span><span class="w"> </span><span class="p">(</span><span class="nv">tl</span><span class="w"> </span><span class="nv">it</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">x</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">tl</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nv">tlist-empty-p</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="p">))</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="tlist-add-right">
<span id="tlist-add-right2"></span><h2><code class="docutils literal notranslate"><span class="pre">tlist-add-right</span></code><a class="headerlink" href="#tlist-add-right" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">tlist-add-right</span><span class="w"> </span><span class="p">(</span><span class="nv">tl</span><span class="w"> </span><span class="nv">it</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">x</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="no">nil</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nv">tlist-empty-p</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">cddr</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="p">))</span><span class="w"></span>
<span class="linenos">6</span><span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="nv">x</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="tlist-rem-left">
<span id="tlist-rem-left2"></span><h2><code class="docutils literal notranslate"><span class="pre">tlist-rem-left</span></code><a class="headerlink" href="#tlist-rem-left" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">declaim</span><span class="w"> </span><span class="p">(</span><span class="k">inline</span><span class="w"> </span><span class="nv">tlist-rem-left</span><span class="p">))</span><span class="w"></span>
<span class="linenos">2</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">tlist-rem-left</span><span class="w"> </span><span class="p">(</span><span class="nv">tl</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nv">tlist-empty-p</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4</span><span class="w">    </span><span class="p">(</span><span class="nb">error</span><span class="w"> </span><span class="s">&quot;Remove from empty tlist&quot;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">5</span><span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">x</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">tl</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">6</span><span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">cdar</span><span class="w"> </span><span class="nv">tl</span><span class="p">))</span><span class="w"></span>
<span class="linenos">7</span><span class="w">    </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nv">tlist-empty-p</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"></span>
<span class="linenos">8</span><span class="w">        </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="no">nil</span><span class="p">))</span><span class="w"> </span><span class="c1">;; For gc</span><span class="w"></span>
<span class="linenos">9</span><span class="w">    </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">x</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="tlist-update">
<span id="tlist-update2"></span><h2><code class="docutils literal notranslate"><span class="pre">tlist-update</span></code><a class="headerlink" href="#tlist-update" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">declaim</span><span class="w"> </span><span class="p">(</span><span class="k">inline</span><span class="w"> </span><span class="nv">tlist-update</span><span class="p">))</span><span class="w"></span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">tlist-update</span><span class="w"> </span><span class="p">(</span><span class="nv">tl</span><span class="p">)</span><span class="w"></span>
<span class="linenos">4</span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="nv">tl</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">last</span><span class="w"> </span><span class="p">(</span><span class="nb">car</span><span class="w"> </span><span class="nv">tl</span><span class="p">))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="build-batcher-sn">
<span id="build-batcher-sn2"></span><h2><code class="docutils literal notranslate"><span class="pre">build-batcher-sn</span></code><a class="headerlink" href="#build-batcher-sn" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">build-batcher-sn</span><span class="w"> </span><span class="p">(</span><span class="nv">n</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 2</span><span class="p">(</span><span class="k">let*</span><span class="w"> </span><span class="p">(</span><span class="nv">network</span><span class="w"></span>
<span class="linenos"> 3</span><span class="w">        </span><span class="p">(</span><span class="nv">tee</span><span class="w"> </span><span class="p">(</span><span class="nb">ceiling</span><span class="w"> </span><span class="p">(</span><span class="nb">log</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="mi">2</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 4</span><span class="w">        </span><span class="p">(</span><span class="nv">p</span><span class="w"> </span><span class="p">(</span><span class="nb">ash</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">tee</span><span class="w"> </span><span class="mi">1</span><span class="p">))))</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p">(</span><span class="nb">loop</span><span class="w"> </span><span class="nv">while</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nb">do</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">q</span><span class="w"> </span><span class="p">(</span><span class="nb">ash</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">tee</span><span class="w"> </span><span class="mi">1</span><span class="p">)))</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">            </span><span class="p">(</span><span class="nv">r</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">            </span><span class="p">(</span><span class="nv">d</span><span class="w"> </span><span class="nv">p</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">        </span><span class="p">(</span><span class="nb">loop</span><span class="w"> </span><span class="nv">while</span><span class="w"> </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nb">do</span><span class="w"></span>
<span class="linenos">10</span><span class="w">        </span><span class="p">(</span><span class="nb">loop</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">from</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="nb">do</span><span class="w"></span>
<span class="linenos">11</span><span class="w">            </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">=</span><span class="w"> </span><span class="p">(</span><span class="nb">logand</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">p</span><span class="p">)</span><span class="w"> </span><span class="nv">r</span><span class="p">)</span><span class="w"></span>
<span class="linenos">12</span><span class="w">            </span><span class="p">(</span><span class="nb">push</span><span class="w"> </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="p">(</span><span class="nb">+</span><span class="w"> </span><span class="nv">i</span><span class="w"> </span><span class="nv">d</span><span class="p">))</span><span class="w"></span>
<span class="linenos">13</span><span class="w">                    </span><span class="nv">network</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">14</span><span class="w">        </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="nv">d</span><span class="w"> </span><span class="p">(</span><span class="nb">-</span><span class="w"> </span><span class="nv">q</span><span class="w"> </span><span class="nv">p</span><span class="p">)</span><span class="w"></span>
<span class="linenos">15</span><span class="w">                </span><span class="nv">q</span><span class="w"> </span><span class="p">(</span><span class="nb">ash</span><span class="w"> </span><span class="nv">q</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">16</span><span class="w">                </span><span class="nv">r</span><span class="w"> </span><span class="nv">p</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">17</span><span class="w">    </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="p">(</span><span class="nb">ash</span><span class="w"> </span><span class="nv">p</span><span class="w"> </span><span class="mi">-1</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">18</span><span class="w">    </span><span class="p">(</span><span class="nb">nreverse</span><span class="w"> </span><span class="nv">network</span><span class="p">)))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="sortf">
<span id="sortf2"></span><h2><code class="docutils literal notranslate"><span class="pre">sortf</span></code><a class="headerlink" href="#sortf" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>(defmacro! sortf (comparator &amp;rest places)
<span class="linenos"> 2</span>(if places
<span class="linenos"> 3</span>    `(tagbody
<span class="linenos"> 4</span>    ,@(mapcar
<span class="linenos"> 5</span>        #`(let ((,g!a #1=,(nth (car a1) places))
<span class="linenos"> 6</span>                (,g!b #2=,(nth (cadr a1) places)))
<span class="linenos"> 7</span>            (if (,comparator ,g!b ,g!a)
<span class="linenos"> 8</span>                (setf #1# ,g!b
<span class="linenos"> 9</span>                    #2# ,g!a)))
<span class="linenos">10</span>        (build-batcher-sn (length places))))))
</pre></div>
</div>
</section>
<section id="dollar-symbol-p">
<span id="dollar-symbol-p2"></span><h2><code class="docutils literal notranslate"><span class="pre">dollar-symbol-p</span></code><a class="headerlink" href="#dollar-symbol-p" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">;;;;;; NEW CODE FOR ANTIWEB</span><span class="w"></span>
<span class="linenos"> 2</span><span class="o">#+</span><span class="nv">cl-ppcre</span><span class="w"></span>
<span class="linenos"> 3</span><span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">dollar-symbol-p</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span><span class="p">(</span><span class="nb">and</span><span class="w"> </span><span class="p">(</span><span class="nb">symbolp</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p">(</span><span class="nb">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nb">length</span><span class="w"> </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">s</span><span class="p">))</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p">(</span><span class="nb">string=</span><span class="w"> </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">                </span><span class="s">&quot;$&quot;</span><span class="w"></span>
<span class="linenos"> 8</span><span class="w">                </span><span class="ss">:start1</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">                </span><span class="ss">:end1</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="linenos">10</span><span class="w">    </span><span class="p">(</span><span class="nb">ignore-errors</span><span class="w"> </span><span class="p">(</span><span class="nb">parse-integer</span><span class="w"> </span><span class="p">(</span><span class="nb">subseq</span><span class="w"> </span><span class="p">(</span><span class="nb">symbol-name</span><span class="w"> </span><span class="nv">s</span><span class="p">)</span><span class="w"> </span><span class="mi">1</span><span class="p">)))))</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="if-match">
<span id="if-match2"></span><h2><code class="docutils literal notranslate"><span class="pre">if-match</span></code><a class="headerlink" href="#if-match" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>(defmacro! if-match ((match-regex str) then &amp;optional else)
<span class="linenos"> 2</span>(let* ((dollars (remove-duplicates
<span class="linenos"> 3</span>                (remove-if-not #&#39;dollar-symbol-p
<span class="linenos"> 4</span>                                (flatten then))))
<span class="linenos"> 5</span>        (top (or (car (sort (mapcar #&#39;dollar-symbol-p dollars) #&#39;&gt;))
<span class="linenos"> 6</span>                0)))
<span class="linenos"> 7</span>    `(multiple-value-bind (,g!matches ,g!captures) (,match-regex ,str)
<span class="linenos"> 8</span>    (declare (ignorable ,g!matches ,g!captures))
<span class="linenos"> 9</span>    (let ((,g!captures-len (length ,g!captures)))
<span class="linenos">10</span>        (declare (ignorable ,g!captures-len))
<span class="linenos">11</span>        (symbol-macrolet ,(mapcar #`(,(symb &quot;$&quot; a1)
<span class="linenos">12</span>                                    (if (&lt; ,g!captures-len ,a1)
<span class="linenos">13</span>                                        (error &quot;Too few matchs: ~a unbound.&quot; ,(mkstr &quot;$&quot; a1))
<span class="linenos">14</span>                                        (aref ,g!captures ,(1- a1))))
<span class="linenos">15</span>                                (loop for i from 1 to top collect i))
<span class="linenos">16</span>        (if ,g!matches
<span class="linenos">17</span>            ,then
<span class="linenos">18</span>            ,else))))))
</pre></div>
</div>
</section>
<section id="when-match">
<span id="when-match2"></span><h2><code class="docutils literal notranslate"><span class="pre">when-match</span></code><a class="headerlink" href="#when-match" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">when-match</span><span class="w"> </span><span class="p">((</span><span class="nv">match-regex</span><span class="w"> </span><span class="nv">str</span><span class="p">)</span><span class="w"> </span><span class="k">&amp;body</span><span class="w"> </span><span class="nv">forms</span><span class="p">)</span><span class="w"></span>
<span class="linenos">2</span><span class="o">`</span><span class="p">(</span><span class="nv">if-match</span><span class="w"> </span><span class="p">(</span><span class="o">,</span><span class="nv">match-regex</span><span class="w"> </span><span class="o">,</span><span class="nv">str</span><span class="p">)</span><span class="w"></span>
<span class="linenos">3</span><span class="w">    </span><span class="p">(</span><span class="k">progn</span><span class="w"> </span><span class="o">,@</span><span class="nv">forms</span><span class="p">)))</span><span class="w"></span>
<span class="linenos">4</span>
<span class="linenos">5</span><span class="c1">;; EOF</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="travis-yml">
<span id="end"></span><span id="id19"></span><h2>.travis.yml<a class="headerlink" href="#travis-yml" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>language: common-lisp
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>sudo: required
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>env:
<span class="linenos"> 6</span>matrix:
<span class="linenos"> 7</span>    - LISP=sbcl COVERALLS=true
<span class="linenos"> 8</span>    - LISP=ccl
<span class="linenos"> 9</span>    # - LISP=clisp
<span class="linenos">10</span>    # - LISP=ecl
<span class="linenos">11</span>    # - LISP=abcl
<span class="linenos">12</span>
<span class="linenos">13</span>install:
<span class="linenos">14</span>- if [ -x ./install.sh ] &amp;&amp; head -2 ./install.sh | grep &#39;^# cl-travis&#39; &gt; /dev/null;
<span class="linenos">15</span>    then
<span class="linenos">16</span>    ./install.sh;
<span class="linenos">17</span>    else
<span class="linenos">18</span>    curl https://raw.githubusercontent.com/luismbo/cl-travis/master/install.sh | sh;
<span class="linenos">19</span>    fi
<span class="linenos">20</span># Coveralls support
<span class="linenos">21</span>- git clone https://github.com/fukamachi/cl-coveralls ~/lisp/cl-coveralls
<span class="linenos">22</span>
<span class="linenos">23</span>script:
<span class="linenos">24</span>- cl -l prove -l cl-coveralls
<span class="linenos">25</span>    -e &#39;(in-package :cl-user)&#39;
<span class="linenos">26</span>    -e &#39;(ql:quickload :let-over-lambda)&#39;
<span class="linenos">27</span>    -e &#39;(setf prove:*debug-on-error* t)&#39;
<span class="linenos">28</span>    -e &#39;(setf *debugger-hook*
<span class="linenos">29</span>                (lambda (c h)
<span class="linenos">30</span>                (declare (ignore c h))
<span class="linenos">31</span>                (uiop:quit -1)))&#39;
<span class="linenos">32</span>    -e &#39;(coveralls:with-coveralls (:exclude (list &quot;t&quot;))
<span class="linenos">33</span>            (or (prove:run :let-over-lambda-test)
<span class="linenos">34</span>                (uiop:quit -1)))&#39;
<span class="linenos">35</span>
<span class="linenos">36</span>notifications:
<span class="linenos">37</span>webhooks:
<span class="linenos">38</span>    urls:
<span class="linenos">39</span>    - https://webhooks.gitter.im/e/fba7308ceb6194ceb9ff
<span class="linenos">40</span>    on_success: change  # options: [always|never|change] default: always
<span class="linenos">41</span>    on_failure: always  # options: [always|never|change] default: always
<span class="linenos">42</span>    on_start: false     # default: false
</pre></div>
</div>
</section>
<section id="circle-yml">
<span id="id20"></span><h2>circle.yml<a class="headerlink" href="#circle-yml" title="Permalink to this heading"></a></h2>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>machine:
<span class="linenos"> 2</span>environment:
<span class="linenos"> 3</span>    PATH: ~/.roswell/bin:$PATH
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>dependencies:
<span class="linenos"> 6</span>pre:
<span class="linenos"> 7</span>    - curl -L https://raw.githubusercontent.com/snmsts/roswell/release/scripts/install-for-ci.sh | sh
<span class="linenos"> 8</span>    - case $CIRCLE_NODE_INDEX in
<span class="linenos"> 9</span>        0) ros config set default.lisp sbcl-bin ;;
<span class="linenos">10</span>        1) ros install ccl-bin;
<span class="linenos">11</span>        ros config set default.lisp ccl-bin ;;
<span class="linenos">12</span>    esac
<span class="linenos">13</span>    - ros run -- --version
<span class="linenos">14</span>override:
<span class="linenos">15</span>    - git clone https://github.com/fukamachi/cl-coveralls ~/lisp/cl-coveralls
<span class="linenos">16</span>    - git clone https://github.com/fukamachi/prove ~/lisp/prove
<span class="linenos">17</span>    - ros -l ~/lisp/prove/prove.asd install prove
<span class="linenos">18</span>
<span class="linenos">19</span>test:
<span class="linenos">20</span>override:
<span class="linenos">21</span>    - if [ &quot;$CIRCLE_NODE_INDEX&quot; = 0 ]; then COVERALLS=true run-prove let-over-lambda-test.asd; else run-prove let-over-lambda-test.asd; fi: {parallel: true}
</pre></div>
</div>
</section>
<section id="let-over-lambda-asd">
<span id="id21"></span><h2>let-over-lambda.asd<a class="headerlink" href="#let-over-lambda-asd" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">;;;; -*- Mode: LISP; Syntax: COMMON-LISP; Package: LET-OVER-LAMBDA; Base: 10 -*- file: let-over-lambda.asd</span><span class="w"></span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="p">(</span><span class="nb">in-package</span><span class="w"> </span><span class="ss">:cl-user</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="p">(</span><span class="nb">defpackage</span><span class="w"> </span><span class="nv">let-over-lambda-asd</span><span class="w"></span>
<span class="linenos"> 6</span><span class="p">(</span><span class="ss">:use</span><span class="w"> </span><span class="ss">:cl</span><span class="w"> </span><span class="ss">:asdf</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 7</span><span class="p">(</span><span class="ss">:export</span><span class="w"> </span><span class="ss">#:*lol-version*</span><span class="p">))</span><span class="w"></span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="p">(</span><span class="nb">in-package</span><span class="w"> </span><span class="ss">:let-over-lambda-asd</span><span class="p">)</span><span class="w"></span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="p">(</span><span class="nb">defparameter</span><span class="w"> </span><span class="vg">*lol-version*</span><span class="w"> </span><span class="s">&quot;1.0.1&quot;</span><span class="w"></span>
<span class="linenos">12</span><span class="s">&quot;A string denoting the current version of LET-OVER-LAMBDA.  Used for diagnostic output.&quot;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="p">(</span><span class="nv">defsystem</span><span class="w"> </span><span class="ss">#:let-over-lambda</span><span class="w"></span>
<span class="linenos">15</span><span class="ss">:serial</span><span class="w"> </span><span class="no">t</span><span class="w"></span>
<span class="linenos">16</span><span class="ss">:description</span><span class="w"> </span><span class="s">&quot;The Production version code from letoverlambda.com, conveniently wrapped in an ASDF System for Quicklisp.&quot;</span><span class="w"></span>
<span class="linenos">17</span><span class="ss">:version</span><span class="w"> </span><span class="o">#.</span><span class="vg">*lol-version*</span><span class="w"></span>
<span class="linenos">18</span><span class="ss">:author</span><span class="w"> </span><span class="s">&quot;Doug Hoyte &lt;doug@hoytech.com&gt;&quot;</span><span class="w"></span>
<span class="linenos">19</span><span class="ss">:maintainer</span><span class="w"> </span><span class="s">&quot;\&quot;the Phoeron\&quot; Colin J.E. Lupton &lt;sysop@thephoeron.com&gt;&quot;</span><span class="w"></span>
<span class="linenos">20</span><span class="ss">:license</span><span class="w"> </span><span class="s">&quot;BSD Simplified&quot;</span><span class="w"></span>
<span class="linenos">21</span><span class="ss">:depends-on</span><span class="w"> </span><span class="p">(</span><span class="ss">#:alexandria</span><span class="w"></span>
<span class="linenos">22</span><span class="w">            </span><span class="ss">#:cl-ppcre</span><span class="w"></span>
<span class="linenos">23</span><span class="w">            </span><span class="ss">#:named-readtables</span><span class="p">)</span><span class="w"></span>
<span class="linenos">24</span><span class="ss">:components</span><span class="w"> </span><span class="p">((</span><span class="ss">:file</span><span class="w"> </span><span class="s">&quot;package&quot;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">25</span><span class="w">            </span><span class="p">(</span><span class="ss">:file</span><span class="w"> </span><span class="s">&quot;let-over-lambda&quot;</span><span class="p">))</span><span class="w"></span>
<span class="linenos">26</span><span class="ss">:in-order-to</span><span class="w"> </span><span class="p">((</span><span class="nv">test-op</span><span class="w"> </span><span class="p">(</span><span class="nv">test-op</span><span class="w"> </span><span class="nv">let-over-lambda-test</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="c1">;; EOF</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="let-over-lambda-lisp-whole">
<span id="id22"></span><h2>let-over-lambda.lisp(whole)<a class="headerlink" href="#let-over-lambda-lisp-whole" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span>;;;; -*- Mode: LISP; Syntax: COMMON-LISP; Package: LET-OVER-LAMBDA; Base: 10 -*- file: let-over-lambda.lisp
<span class="linenos">  2</span>
<span class="linenos">  3</span>(in-package #:let-over-lambda)
<span class="linenos">  4</span>
<span class="linenos">  5</span>;; Antiweb (C) Doug Hoyte
<span class="linenos">  6</span>
<span class="linenos">  7</span>;; This is a &quot;production&quot; version of LOL with bug-fixes
<span class="linenos">  8</span>;; and new features in the spirit of the book.
<span class="linenos">  9</span>
<span class="linenos"> 10</span>;; See http://letoverlambda.com
<span class="linenos"> 11</span>
<span class="linenos"> 12</span>;; This is the source code for the book
<span class="linenos"> 13</span>;; _Let_Over_Lambda_ by Doug Hoyte.
<span class="linenos"> 14</span>;; This code is (C) 2002-2008, Doug Hoyte.
<span class="linenos"> 15</span>;;
<span class="linenos"> 16</span>;; You are free to use, modify, and re-distribute
<span class="linenos"> 17</span>;; this code however you want, except that any
<span class="linenos"> 18</span>;; modifications must be clearly indicated before
<span class="linenos"> 19</span>;; re-distribution. There is no warranty,
<span class="linenos"> 20</span>;; expressed nor implied.
<span class="linenos"> 21</span>;;
<span class="linenos"> 22</span>;; Attribution of this code to me, Doug Hoyte, is
<span class="linenos"> 23</span>;; appreciated but not necessary. If you find the
<span class="linenos"> 24</span>;; code useful, or would like documentation,
<span class="linenos"> 25</span>;; please consider buying the book!
<span class="linenos"> 26</span>
<span class="linenos"> 27</span>;; Modifications by &quot;the Phoeron&quot; Colin J.E. Lupton, 2012--2014
<span class="linenos"> 28</span>;; - Support for ASDF/Quicklisp
<span class="linenos"> 29</span>;; - Cheap hacks to support new Backquote implementation in SBCL v1.2.2
<span class="linenos"> 30</span>
<span class="linenos"> 31</span>;; Safety feature for SBCL&gt;=v1.2.2
<span class="linenos"> 32</span>#+sbcl
<span class="linenos"> 33</span>(eval-when (:compile-toplevel :execute)
<span class="linenos"> 34</span>(handler-case
<span class="linenos"> 35</span>    (progn
<span class="linenos"> 36</span>        (sb-ext:assert-version-&gt;= 1 2 2)
<span class="linenos"> 37</span>        (setq *features* (remove &#39;old-sbcl *features*)))
<span class="linenos"> 38</span>    (error ()
<span class="linenos"> 39</span>    (pushnew &#39;old-sbcl *features*))))
<span class="linenos"> 40</span>
<span class="linenos"> 41</span>(defun group (source n)
<span class="linenos"> 42</span>(if (zerop n) (error &quot;zero length&quot;))
<span class="linenos"> 43</span>(labels ((rec (source acc)
<span class="linenos"> 44</span>            (let ((rest (nthcdr n source)))
<span class="linenos"> 45</span>            (if (consp rest)
<span class="linenos"> 46</span>                (rec rest (cons
<span class="linenos"> 47</span>                            (subseq source 0 n)
<span class="linenos"> 48</span>                            acc))
<span class="linenos"> 49</span>                (nreverse
<span class="linenos"> 50</span>                    (cons source acc))))))
<span class="linenos"> 51</span>    (if source (rec source nil) nil)))
<span class="linenos"> 52</span>
<span class="linenos"> 53</span>(eval-when (:compile-toplevel :execute :load-toplevel)
<span class="linenos"> 54</span>(defun mkstr (&amp;rest args)
<span class="linenos"> 55</span>    (with-output-to-string (s)
<span class="linenos"> 56</span>    (dolist (a args) (princ a s))))
<span class="linenos"> 57</span>
<span class="linenos"> 58</span>(defun symb (&amp;rest args)
<span class="linenos"> 59</span>    (values (intern (apply #&#39;mkstr args))))
<span class="linenos"> 60</span>
<span class="linenos"> 61</span>(defun flatten (x)
<span class="linenos"> 62</span>    (labels ((rec (x acc)
<span class="linenos"> 63</span>                (cond ((null x) acc)
<span class="linenos"> 64</span>                        #+(and sbcl (not lol::old-sbcl))
<span class="linenos"> 65</span>                        ((typep x &#39;sb-impl::comma) (rec (sb-impl::comma-expr x) acc))
<span class="linenos"> 66</span>                        ((atom x) (cons x acc))
<span class="linenos"> 67</span>                        (t (rec
<span class="linenos"> 68</span>                            (car x)
<span class="linenos"> 69</span>                            (rec (cdr x) acc))))))
<span class="linenos"> 70</span>    (rec x nil)))
<span class="linenos"> 71</span>
<span class="linenos"> 72</span>(defun g!-symbol-p (s)
<span class="linenos"> 73</span>    (and (symbolp s)
<span class="linenos"> 74</span>        (&gt; (length (symbol-name s)) 2)
<span class="linenos"> 75</span>        (string= (symbol-name s)
<span class="linenos"> 76</span>                &quot;G!&quot;
<span class="linenos"> 77</span>                :start1 0
<span class="linenos"> 78</span>                :end1 2)))
<span class="linenos"> 79</span>
<span class="linenos"> 80</span>(defun o!-symbol-p (s)
<span class="linenos"> 81</span>    (and (symbolp s)
<span class="linenos"> 82</span>        (&gt; (length (symbol-name s)) 2)
<span class="linenos"> 83</span>        (string= (symbol-name s)
<span class="linenos"> 84</span>                &quot;O!&quot;
<span class="linenos"> 85</span>                :start1 0
<span class="linenos"> 86</span>                :end1 2)))
<span class="linenos"> 87</span>
<span class="linenos"> 88</span>(defun o!-symbol-to-g!-symbol (s)
<span class="linenos"> 89</span>    (symb &quot;G!&quot;
<span class="linenos"> 90</span>        (subseq (symbol-name s) 2))))
<span class="linenos"> 91</span>
<span class="linenos"> 92</span>(defmacro defmacro/g! (name args &amp;rest body)
<span class="linenos"> 93</span>(let ((syms (remove-duplicates
<span class="linenos"> 94</span>            (remove-if-not #&#39;g!-symbol-p
<span class="linenos"> 95</span>                            (flatten body)))))
<span class="linenos"> 96</span>    (multiple-value-bind (body declarations docstring)
<span class="linenos"> 97</span>        (parse-body body :documentation t)
<span class="linenos"> 98</span>    `(defmacro ,name ,args
<span class="linenos"> 99</span>        ,@(when docstring
<span class="linenos">100</span>            (list docstring))
<span class="linenos">101</span>        ,@declarations
<span class="linenos">102</span>        (let ,(mapcar
<span class="linenos">103</span>                (lambda (s)
<span class="linenos">104</span>                `(,s (gensym ,(subseq
<span class="linenos">105</span>                                (symbol-name s)
<span class="linenos">106</span>                                2))))
<span class="linenos">107</span>                syms)
<span class="linenos">108</span>        ,@body)))))
<span class="linenos">109</span>
<span class="linenos">110</span>(defmacro defmacro! (name args &amp;rest body)
<span class="linenos">111</span>(let* ((os (remove-if-not #&#39;o!-symbol-p (flatten args)))
<span class="linenos">112</span>        (gs (mapcar #&#39;o!-symbol-to-g!-symbol os)))
<span class="linenos">113</span>    (multiple-value-bind (body declarations docstring)
<span class="linenos">114</span>        (parse-body body :documentation t)
<span class="linenos">115</span>    `(defmacro/g! ,name ,args
<span class="linenos">116</span>        ,@(when docstring
<span class="linenos">117</span>            (list docstring))
<span class="linenos">118</span>        ,@declarations
<span class="linenos">119</span>        `(let ,(mapcar #&#39;list (list ,@gs) (list ,@os))
<span class="linenos">120</span>            ,(progn ,@body))))))
<span class="linenos">121</span>
<span class="linenos">122</span>(defmacro defun! (name args &amp;body body)
<span class="linenos">123</span>(let ((syms (remove-duplicates
<span class="linenos">124</span>            (remove-if-not #&#39;g!-symbol-p
<span class="linenos">125</span>                            (flatten body)))))
<span class="linenos">126</span>    (multiple-value-bind (body declarations docstring)
<span class="linenos">127</span>        (parse-body body :documentation t)
<span class="linenos">128</span>    `(defun ,name ,args
<span class="linenos">129</span>        ,@(when docstring
<span class="linenos">130</span>            (list docstring))
<span class="linenos">131</span>        ,@declarations
<span class="linenos">132</span>        (let ,(mapcar (lambda (s)
<span class="linenos">133</span>                        `(,s (gensym ,(subseq (symbol-name s)
<span class="linenos">134</span>                                            2))))
<span class="linenos">135</span>                    syms)
<span class="linenos">136</span>        ,@body)))))
<span class="linenos">137</span>
<span class="linenos">138</span>;; Nestable suggestion from Daniel Herring
<span class="linenos">139</span>(eval-when (:compile-toplevel :load-toplevel :execute)
<span class="linenos">140</span>(defun |#&quot;-reader| (stream sub-char numarg)
<span class="linenos">141</span>(declare (ignore sub-char numarg))
<span class="linenos">142</span>(let (chars (state &#39;normal) (depth 1))
<span class="linenos">143</span>    (loop do
<span class="linenos">144</span>        (let ((curr (read-char stream)))
<span class="linenos">145</span>            (cond ((eq state &#39;normal)
<span class="linenos">146</span>                (cond ((char= curr #\#)
<span class="linenos">147</span>                        (push #\# chars)
<span class="linenos">148</span>                        (setq state &#39;read-sharp))
<span class="linenos">149</span>                        ((char= curr #\&quot;)
<span class="linenos">150</span>                        (setq state &#39;read-quote))
<span class="linenos">151</span>                        (t
<span class="linenos">152</span>                        (push curr chars))))
<span class="linenos">153</span>                ((eq state &#39;read-sharp)
<span class="linenos">154</span>                (cond ((char= curr #\&quot;)
<span class="linenos">155</span>                        (push #\&quot; chars)
<span class="linenos">156</span>                        (incf depth)
<span class="linenos">157</span>                        (setq state &#39;normal))
<span class="linenos">158</span>                        (t
<span class="linenos">159</span>                        (push curr chars)
<span class="linenos">160</span>                        (setq state &#39;normal))))
<span class="linenos">161</span>                ((eq state &#39;read-quote)
<span class="linenos">162</span>                (cond ((char= curr #\#)
<span class="linenos">163</span>                        (decf depth)
<span class="linenos">164</span>                        (if (zerop depth) (return))
<span class="linenos">165</span>                        (push #\&quot; chars)
<span class="linenos">166</span>                        (push #\# chars)
<span class="linenos">167</span>                        (setq state &#39;normal))
<span class="linenos">168</span>                        (t
<span class="linenos">169</span>                        (push #\&quot; chars)
<span class="linenos">170</span>                        (if (char= curr #\&quot;)
<span class="linenos">171</span>                            (setq state &#39;read-quote)
<span class="linenos">172</span>                            (progn
<span class="linenos">173</span>                                (push curr chars)
<span class="linenos">174</span>                                (setq state &#39;normal)))))))))
<span class="linenos">175</span>    (coerce (nreverse chars) &#39;string))))
<span class="linenos">176</span>
<span class="linenos">177</span>; (set-dispatch-macro-character #\# #\&quot; #&#39;|#&quot;-reader|)
<span class="linenos">178</span>
<span class="linenos">179</span>; This version is from Martin Dirichs
<span class="linenos">180</span>(eval-when (:compile-toplevel :load-toplevel :execute)
<span class="linenos">181</span>(defun |#&gt;-reader| (stream sub-char numarg)
<span class="linenos">182</span>    (declare (ignore sub-char numarg))
<span class="linenos">183</span>    (let (chars)
<span class="linenos">184</span>    (do ((curr (read-char stream)
<span class="linenos">185</span>                (read-char stream)))
<span class="linenos">186</span>        ((char= #\newline curr))
<span class="linenos">187</span>        (push curr chars))
<span class="linenos">188</span>    (let ((pattern (nreverse chars))
<span class="linenos">189</span>            output)
<span class="linenos">190</span>        (labels ((match (pos chars)
<span class="linenos">191</span>                (if (null chars)
<span class="linenos">192</span>                    pos
<span class="linenos">193</span>                    (if (char= (nth pos pattern) (car chars))
<span class="linenos">194</span>                        (match (1+ pos) (cdr chars))
<span class="linenos">195</span>                        (match 0 (cdr (append (subseq pattern 0 pos) chars)))))))
<span class="linenos">196</span>        (do (curr
<span class="linenos">197</span>            (pos 0))
<span class="linenos">198</span>            ((= pos (length pattern)))
<span class="linenos">199</span>            (setf curr (read-char stream)
<span class="linenos">200</span>                pos (match pos (list curr)))
<span class="linenos">201</span>            (push curr output))
<span class="linenos">202</span>        (coerce
<span class="linenos">203</span>        (nreverse
<span class="linenos">204</span>            (nthcdr (length pattern) output))
<span class="linenos">205</span>        &#39;string))))))
<span class="linenos">206</span>
<span class="linenos">207</span>; (set-dispatch-macro-character #\# #\&gt; #&#39;|#&gt;-reader|)
<span class="linenos">208</span>
<span class="linenos">209</span>(defun segment-reader (stream ch n)
<span class="linenos">210</span>(if (&gt; n 0)
<span class="linenos">211</span>    (let ((chars))
<span class="linenos">212</span>    (do ((curr (read-char stream)
<span class="linenos">213</span>                (read-char stream)))
<span class="linenos">214</span>        ((char= ch curr))
<span class="linenos">215</span>        (push curr chars))
<span class="linenos">216</span>    (cons (coerce (nreverse chars) &#39;string)
<span class="linenos">217</span>            (segment-reader stream ch (- n 1))))))
<span class="linenos">218</span>
<span class="linenos">219</span>#+cl-ppcre
<span class="linenos">220</span>(defmacro! match-mode-ppcre-lambda-form (o!args o!mods)
<span class="linenos">221</span>``(lambda (,&#39;,g!str)
<span class="linenos">222</span>    (ppcre:scan-to-strings
<span class="linenos">223</span>    ,(if (zerop (length ,g!mods))
<span class="linenos">224</span>        (car ,g!args)
<span class="linenos">225</span>        (format nil &quot;(?~a)~a&quot; ,g!mods (car ,g!args)))
<span class="linenos">226</span>    ,&#39;,g!str)))
<span class="linenos">227</span>
<span class="linenos">228</span>#+cl-ppcre
<span class="linenos">229</span>(defmacro! subst-mode-ppcre-lambda-form (o!args)
<span class="linenos">230</span>``(lambda (,&#39;,g!str)
<span class="linenos">231</span>    (cl-ppcre:regex-replace-all
<span class="linenos">232</span>    ,(car ,g!args)
<span class="linenos">233</span>    ,&#39;,g!str
<span class="linenos">234</span>    ,(cadr ,g!args))))
<span class="linenos">235</span>
<span class="linenos">236</span>#+cl-ppcre
<span class="linenos">237</span>(eval-when (:compile-toplevel :load-toplevel :execute)
<span class="linenos">238</span>(defun |#~-reader| (stream sub-char numarg)
<span class="linenos">239</span>    (declare (ignore sub-char numarg))
<span class="linenos">240</span>    (let ((mode-char (read-char stream)))
<span class="linenos">241</span>    (cond
<span class="linenos">242</span>        ((char= mode-char #\m)
<span class="linenos">243</span>        (match-mode-ppcre-lambda-form
<span class="linenos">244</span>        (segment-reader stream
<span class="linenos">245</span>                        (read-char stream)
<span class="linenos">246</span>                        1)
<span class="linenos">247</span>        (coerce (loop for c = (read-char stream)
<span class="linenos">248</span>                    while (alpha-char-p c)
<span class="linenos">249</span>                    collect c
<span class="linenos">250</span>                    finally (unread-char c stream))
<span class="linenos">251</span>                &#39;string)))
<span class="linenos">252</span>        ((char= mode-char #\s)
<span class="linenos">253</span>        (subst-mode-ppcre-lambda-form
<span class="linenos">254</span>        (segment-reader stream
<span class="linenos">255</span>                        (read-char stream)
<span class="linenos">256</span>                        2)))
<span class="linenos">257</span>        (t (error &quot;Unknown #~~ mode character&quot;))))))
<span class="linenos">258</span>
<span class="linenos">259</span>; #+cl-ppcre (set-dispatch-macro-character #\# #\~ #&#39;|#~-reader|)
<span class="linenos">260</span>
<span class="linenos">261</span>(defmacro! dlambda (&amp;rest ds)
<span class="linenos">262</span>`(lambda (&amp;rest ,g!args)
<span class="linenos">263</span>    (case (car ,g!args)
<span class="linenos">264</span>    ,@(mapcar
<span class="linenos">265</span>        (lambda (d)
<span class="linenos">266</span>            `(,(if (eq t (car d))
<span class="linenos">267</span>                t
<span class="linenos">268</span>                (list (car d)))
<span class="linenos">269</span>            (apply (lambda ,@(cdr d))
<span class="linenos">270</span>                    ,(if (eq t (car d))
<span class="linenos">271</span>                        g!args
<span class="linenos">272</span>                        `(cdr ,g!args)))))
<span class="linenos">273</span>        ds))))
<span class="linenos">274</span>
<span class="linenos">275</span>;; Graham&#39;s alambda
<span class="linenos">276</span>(defmacro alambda (parms &amp;body body)
<span class="linenos">277</span>`(labels ((self ,parms ,@body))
<span class="linenos">278</span>    #&#39;self))
<span class="linenos">279</span>
<span class="linenos">280</span>;; Graham&#39;s aif
<span class="linenos">281</span>(defmacro aif (test then &amp;optional else)
<span class="linenos">282</span>`(let ((it ,test))
<span class="linenos">283</span>    (if it ,then ,else)))
<span class="linenos">284</span>
<span class="linenos">285</span>(eval-when (:compile-toplevel :execute :load-toplevel)
<span class="linenos">286</span>(defun |#`-reader| (stream sub-char numarg)
<span class="linenos">287</span>    (declare (ignore sub-char))
<span class="linenos">288</span>    (unless numarg (setq numarg 1))
<span class="linenos">289</span>    `(lambda ,(loop for i from 1 to numarg
<span class="linenos">290</span>                collect (symb &#39;a i))
<span class="linenos">291</span>    ,(funcall
<span class="linenos">292</span>        (get-macro-character #\`) stream nil)))
<span class="linenos">293</span>
<span class="linenos">294</span>(defun |#f-reader| (stream sub-char numarg)
<span class="linenos">295</span>    (declare (ignore stream sub-char))
<span class="linenos">296</span>    (setq numarg (or numarg 3))
<span class="linenos">297</span>    (unless (&lt;= numarg 3)
<span class="linenos">298</span>    (error &quot;Bad value for #f: ~a&quot; numarg))
<span class="linenos">299</span>    `(declare (optimize (speed ,numarg)
<span class="linenos">300</span>                        (safety ,(- 3 numarg)))))
<span class="linenos">301</span>
<span class="linenos">302</span>(defreadtable lol-syntax
<span class="linenos">303</span>    (:merge :standard)
<span class="linenos">304</span>    (:dispatch-macro-char #\# #\&quot; #&#39;|#&quot;-reader|)
<span class="linenos">305</span>    (:dispatch-macro-char #\# #\&gt; #&#39;|#&gt;-reader|)
<span class="linenos">306</span>    #+cl-ppcre
<span class="linenos">307</span>    (:dispatch-macro-char #\# #\~ #&#39;|#~-reader|)
<span class="linenos">308</span>    (:dispatch-macro-char #\# #\` #&#39;|#`-reader|)
<span class="linenos">309</span>    (:dispatch-macro-char #\# #\f #&#39;|#f-reader|)))
<span class="linenos">310</span>
<span class="linenos">311</span>(in-readtable lol-syntax)
<span class="linenos">312</span>
<span class="linenos">313</span>(defmacro! nlet-tail (n letargs &amp;body body)
<span class="linenos">314</span>(let ((gs (loop for i in letargs
<span class="linenos">315</span>            collect (gensym))))
<span class="linenos">316</span>    `(macrolet
<span class="linenos">317</span>        ((,n ,gs
<span class="linenos">318</span>            `(progn
<span class="linenos">319</span>            (psetq
<span class="linenos">320</span>                ,@(apply #&#39;nconc
<span class="linenos">321</span>                        (mapcar
<span class="linenos">322</span>                        #&#39;list
<span class="linenos">323</span>                        &#39;,(mapcar #&#39;car letargs)
<span class="linenos">324</span>                        (list ,@gs))))
<span class="linenos">325</span>            (go ,&#39;,g!n))))
<span class="linenos">326</span>    (block ,g!b
<span class="linenos">327</span>        (let ,letargs
<span class="linenos">328</span>        (tagbody
<span class="linenos">329</span>            ,g!n (return-from
<span class="linenos">330</span>                    ,g!b (progn ,@body))))))))
<span class="linenos">331</span>
<span class="linenos">332</span>(defmacro alet% (letargs &amp;rest body)
<span class="linenos">333</span>`(let ((this) ,@letargs)
<span class="linenos">334</span>    (setq this ,@(last body))
<span class="linenos">335</span>    ,@(butlast body)
<span class="linenos">336</span>    this))
<span class="linenos">337</span>
<span class="linenos">338</span>(defmacro alet (letargs &amp;rest body)
<span class="linenos">339</span>`(let ((this) ,@letargs)
<span class="linenos">340</span>    (setq this ,@(last body))
<span class="linenos">341</span>    ,@(butlast body)
<span class="linenos">342</span>    (lambda (&amp;rest params)
<span class="linenos">343</span>    (apply this params))))
<span class="linenos">344</span>
<span class="linenos">345</span>(defun let-binding-transform (bs)
<span class="linenos">346</span>(if bs
<span class="linenos">347</span>    (cons
<span class="linenos">348</span>    (cond ((symbolp (car bs))
<span class="linenos">349</span>            (list (car bs)))
<span class="linenos">350</span>            ((consp (car bs))
<span class="linenos">351</span>            (car bs))
<span class="linenos">352</span>            (t
<span class="linenos">353</span>            (error &quot;Bad let bindings&quot;)))
<span class="linenos">354</span>    (let-binding-transform (cdr bs)))))
<span class="linenos">355</span>
<span class="linenos">356</span>(defmacro pandoriclet (letargs &amp;rest body)
<span class="linenos">357</span>(let ((letargs (cons
<span class="linenos">358</span>                &#39;(this)
<span class="linenos">359</span>                (let-binding-transform
<span class="linenos">360</span>                    letargs))))
<span class="linenos">361</span>    `(let (,@letargs)
<span class="linenos">362</span>    (setq this ,@(last body))
<span class="linenos">363</span>    ,@(butlast body)
<span class="linenos">364</span>    (dlambda
<span class="linenos">365</span>        (:pandoric-get (sym)
<span class="linenos">366</span>        ,(pandoriclet-get letargs))
<span class="linenos">367</span>        (:pandoric-set (sym val)
<span class="linenos">368</span>        ,(pandoriclet-set letargs))
<span class="linenos">369</span>        (t (&amp;rest args)
<span class="linenos">370</span>        (apply this args))))))
<span class="linenos">371</span>
<span class="linenos">372</span>(defun pandoriclet-get (letargs)
<span class="linenos">373</span>`(case sym
<span class="linenos">374</span>    ,@(mapcar #`((,(car a1)) ,(car a1))
<span class="linenos">375</span>            letargs)
<span class="linenos">376</span>    (t (error
<span class="linenos">377</span>        &quot;Unknown pandoric get: ~a&quot;
<span class="linenos">378</span>        sym))))
<span class="linenos">379</span>
<span class="linenos">380</span>(defun pandoriclet-set (letargs)
<span class="linenos">381</span>`(case sym
<span class="linenos">382</span>    ,@(mapcar #`((,(car a1))
<span class="linenos">383</span>                (setq ,(car a1) val))
<span class="linenos">384</span>            letargs)
<span class="linenos">385</span>    (t (error
<span class="linenos">386</span>        &quot;Unknown pandoric set: ~a&quot;
<span class="linenos">387</span>        sym))))
<span class="linenos">388</span>
<span class="linenos">389</span>(declaim (inline get-pandoric))
<span class="linenos">390</span>
<span class="linenos">391</span>(defun get-pandoric (box sym)
<span class="linenos">392</span>(funcall box :pandoric-get sym))
<span class="linenos">393</span>
<span class="linenos">394</span>(defsetf get-pandoric (box sym) (val)
<span class="linenos">395</span>`(progn
<span class="linenos">396</span>    (funcall ,box :pandoric-set ,sym ,val)
<span class="linenos">397</span>    ,val))
<span class="linenos">398</span>
<span class="linenos">399</span>(defmacro with-pandoric (syms box &amp;rest body)
<span class="linenos">400</span>(let ((g!box (gensym &quot;box&quot;)))
<span class="linenos">401</span>    `(let ((,g!box ,box))
<span class="linenos">402</span>    (declare (ignorable ,g!box))
<span class="linenos">403</span>    (symbol-macrolet
<span class="linenos">404</span>        (,@(mapcar #`(,a1 (get-pandoric ,g!box &#39;,a1))
<span class="linenos">405</span>                    syms))
<span class="linenos">406</span>        ,@body))))
<span class="linenos">407</span>
<span class="linenos">408</span>(defun pandoric-hotpatch (box new)
<span class="linenos">409</span>(with-pandoric (this) box
<span class="linenos">410</span>    (setq this new)))
<span class="linenos">411</span>
<span class="linenos">412</span>(defmacro pandoric-recode (vars box new)
<span class="linenos">413</span>`(with-pandoric (this ,@vars) ,box
<span class="linenos">414</span>    (setq this ,new)))
<span class="linenos">415</span>
<span class="linenos">416</span>(defmacro plambda (largs pargs &amp;rest body)
<span class="linenos">417</span>(let ((pargs (mapcar #&#39;list pargs)))
<span class="linenos">418</span>    `(let (this self)
<span class="linenos">419</span>    (setq
<span class="linenos">420</span>        this (lambda ,largs ,@body)
<span class="linenos">421</span>        self (dlambda
<span class="linenos">422</span>                (:pandoric-get (sym)
<span class="linenos">423</span>                ,(pandoriclet-get pargs))
<span class="linenos">424</span>                (:pandoric-set (sym val)
<span class="linenos">425</span>                ,(pandoriclet-set pargs))
<span class="linenos">426</span>                (t (&amp;rest args)
<span class="linenos">427</span>                (apply this args)))))))
<span class="linenos">428</span>
<span class="linenos">429</span>(defvar pandoric-eval-tunnel)
<span class="linenos">430</span>
<span class="linenos">431</span>(defmacro pandoric-eval (vars expr)
<span class="linenos">432</span>`(let ((pandoric-eval-tunnel
<span class="linenos">433</span>        (plambda () ,vars t)))
<span class="linenos">434</span>    (eval `(with-pandoric
<span class="linenos">435</span>            ,&#39;,vars pandoric-eval-tunnel
<span class="linenos">436</span>            ,,expr))))
<span class="linenos">437</span>
<span class="linenos">438</span>;; Chapter 7
<span class="linenos">439</span>
<span class="linenos">440</span>
<span class="linenos">441</span>(defmacro fast-progn (&amp;rest body)
<span class="linenos">442</span>`(locally #f ,@body))
<span class="linenos">443</span>
<span class="linenos">444</span>(defmacro safe-progn (&amp;rest body)
<span class="linenos">445</span>`(locally #0f ,@body))
<span class="linenos">446</span>
<span class="linenos">447</span>(defun fformat (&amp;rest all)
<span class="linenos">448</span>(apply #&#39;format all))
<span class="linenos">449</span>
<span class="linenos">450</span>(define-compiler-macro fformat
<span class="linenos">451</span>                    (&amp;whole form
<span class="linenos">452</span>                        stream fmt &amp;rest args)
<span class="linenos">453</span>(if (constantp fmt)
<span class="linenos">454</span>    (if stream
<span class="linenos">455</span>    `(funcall (formatter ,fmt)
<span class="linenos">456</span>        ,stream ,@args)
<span class="linenos">457</span>    (let ((g!stream (gensym &quot;stream&quot;)))
<span class="linenos">458</span>        `(with-output-to-string (,g!stream)
<span class="linenos">459</span>        (funcall (formatter ,fmt)
<span class="linenos">460</span>            ,g!stream ,@args))))
<span class="linenos">461</span>    form))
<span class="linenos">462</span>
<span class="linenos">463</span>(declaim (inline make-tlist tlist-left
<span class="linenos">464</span>                tlist-right tlist-empty-p))
<span class="linenos">465</span>
<span class="linenos">466</span>(defun make-tlist () (cons nil nil))
<span class="linenos">467</span>(defun tlist-left (tl) (caar tl))
<span class="linenos">468</span>(defun tlist-right (tl) (cadr tl))
<span class="linenos">469</span>(defun tlist-empty-p (tl) (null (car tl)))
<span class="linenos">470</span>
<span class="linenos">471</span>(declaim (inline tlist-add-left
<span class="linenos">472</span>                tlist-add-right))
<span class="linenos">473</span>
<span class="linenos">474</span>(defun tlist-add-left (tl it)
<span class="linenos">475</span>(let ((x (cons it (car tl))))
<span class="linenos">476</span>    (if (tlist-empty-p tl)
<span class="linenos">477</span>    (setf (cdr tl) x))
<span class="linenos">478</span>    (setf (car tl) x)))
<span class="linenos">479</span>
<span class="linenos">480</span>(defun tlist-add-right (tl it)
<span class="linenos">481</span>(let ((x (cons it nil)))
<span class="linenos">482</span>    (if (tlist-empty-p tl)
<span class="linenos">483</span>    (setf (car tl) x)
<span class="linenos">484</span>    (setf (cddr tl) x))
<span class="linenos">485</span>    (setf (cdr tl) x)))
<span class="linenos">486</span>
<span class="linenos">487</span>(declaim (inline tlist-rem-left))
<span class="linenos">488</span>
<span class="linenos">489</span>(defun tlist-rem-left (tl)
<span class="linenos">490</span>(if (tlist-empty-p tl)
<span class="linenos">491</span>    (error &quot;Remove from empty tlist&quot;)
<span class="linenos">492</span>    (let ((x (car tl)))
<span class="linenos">493</span>    (setf (car tl) (cdar tl))
<span class="linenos">494</span>    (if (tlist-empty-p tl)
<span class="linenos">495</span>        (setf (cdr tl) nil)) ;; For gc
<span class="linenos">496</span>    (car x))))
<span class="linenos">497</span>
<span class="linenos">498</span>(declaim (inline tlist-update))
<span class="linenos">499</span>
<span class="linenos">500</span>(defun tlist-update (tl)
<span class="linenos">501</span>(setf (cdr tl) (last (car tl))))
<span class="linenos">502</span>
<span class="linenos">503</span>(defun build-batcher-sn (n)
<span class="linenos">504</span>(let* (network
<span class="linenos">505</span>        (tee (ceiling (log n 2)))
<span class="linenos">506</span>        (p (ash 1 (- tee 1))))
<span class="linenos">507</span>    (loop while (&gt; p 0) do
<span class="linenos">508</span>    (let ((q (ash 1 (- tee 1)))
<span class="linenos">509</span>            (r 0)
<span class="linenos">510</span>            (d p))
<span class="linenos">511</span>        (loop while (&gt; d 0) do
<span class="linenos">512</span>        (loop for i from 0 to (- n d 1) do
<span class="linenos">513</span>            (if (= (logand i p) r)
<span class="linenos">514</span>            (push (list i (+ i d))
<span class="linenos">515</span>                    network)))
<span class="linenos">516</span>        (setf d (- q p)
<span class="linenos">517</span>                q (ash q -1)
<span class="linenos">518</span>                r p)))
<span class="linenos">519</span>    (setf p (ash p -1)))
<span class="linenos">520</span>    (nreverse network)))
<span class="linenos">521</span>
<span class="linenos">522</span>(defmacro! sortf (comparator &amp;rest places)
<span class="linenos">523</span>(if places
<span class="linenos">524</span>    `(tagbody
<span class="linenos">525</span>    ,@(mapcar
<span class="linenos">526</span>        #`(let ((,g!a #1=,(nth (car a1) places))
<span class="linenos">527</span>                (,g!b #2=,(nth (cadr a1) places)))
<span class="linenos">528</span>            (if (,comparator ,g!b ,g!a)
<span class="linenos">529</span>                (setf #1# ,g!b
<span class="linenos">530</span>                    #2# ,g!a)))
<span class="linenos">531</span>        (build-batcher-sn (length places))))))
<span class="linenos">532</span>
<span class="linenos">533</span>;;;;;; NEW CODE FOR ANTIWEB
<span class="linenos">534</span>#+cl-ppcre
<span class="linenos">535</span>(defun dollar-symbol-p (s)
<span class="linenos">536</span>(and (symbolp s)
<span class="linenos">537</span>    (&gt; (length (symbol-name s)) 1)
<span class="linenos">538</span>    (string= (symbol-name s)
<span class="linenos">539</span>                &quot;$&quot;
<span class="linenos">540</span>                :start1 0
<span class="linenos">541</span>                :end1 1)
<span class="linenos">542</span>    (ignore-errors (parse-integer (subseq (symbol-name s) 1)))))
<span class="linenos">543</span>
<span class="linenos">544</span>(defmacro! if-match ((match-regex str) then &amp;optional else)
<span class="linenos">545</span>(let* ((dollars (remove-duplicates
<span class="linenos">546</span>                (remove-if-not #&#39;dollar-symbol-p
<span class="linenos">547</span>                                (flatten then))))
<span class="linenos">548</span>        (top (or (car (sort (mapcar #&#39;dollar-symbol-p dollars) #&#39;&gt;))
<span class="linenos">549</span>                0)))
<span class="linenos">550</span>    `(multiple-value-bind (,g!matches ,g!captures) (,match-regex ,str)
<span class="linenos">551</span>    (declare (ignorable ,g!matches ,g!captures))
<span class="linenos">552</span>    (let ((,g!captures-len (length ,g!captures)))
<span class="linenos">553</span>        (declare (ignorable ,g!captures-len))
<span class="linenos">554</span>        (symbol-macrolet ,(mapcar #`(,(symb &quot;$&quot; a1)
<span class="linenos">555</span>                                    (if (&lt; ,g!captures-len ,a1)
<span class="linenos">556</span>                                        (error &quot;Too few matchs: ~a unbound.&quot; ,(mkstr &quot;$&quot; a1))
<span class="linenos">557</span>                                        (aref ,g!captures ,(1- a1))))
<span class="linenos">558</span>                                (loop for i from 1 to top collect i))
<span class="linenos">559</span>        (if ,g!matches
<span class="linenos">560</span>            ,then
<span class="linenos">561</span>            ,else))))))
<span class="linenos">562</span>
<span class="linenos">563</span>
<span class="linenos">564</span>(defmacro when-match ((match-regex str) &amp;body forms)
<span class="linenos">565</span>`(if-match (,match-regex ,str)
<span class="linenos">566</span>    (progn ,@forms)))
<span class="linenos">567</span>
<span class="linenos">568</span>;; EOF
</pre></div>
</div>
</section>
<section id="let-over-lambda-test-asd">
<span id="id23"></span><h2>let-over-lambda-test.asd<a class="headerlink" href="#let-over-lambda-test-asd" title="Permalink to this heading"></a></h2>
</section>
<section id="id24">
<h2>LICENSE<a class="headerlink" href="#id24" title="Permalink to this heading"></a></h2>
</section>
<section id="package-lisp">
<h2>package.lisp<a class="headerlink" href="#package-lisp" title="Permalink to this heading"></a></h2>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">;;;; -*- Mode: LISP; Syntax: COMMON-LISP; Package: LET-OVER-LAMBDA; Base: 10 -*- file: package.lisp</span><span class="w"></span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="p">(</span><span class="nb">defpackage</span><span class="w"> </span><span class="ss">#:let-over-lambda</span><span class="w"></span>
<span class="linenos"> 4</span><span class="p">(</span><span class="ss">:nicknames</span><span class="w"> </span><span class="ss">#:lol</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 5</span><span class="p">(</span><span class="ss">:use</span><span class="w"> </span><span class="ss">#:cl</span><span class="w"> </span><span class="ss">#:cl-user</span><span class="w"> </span><span class="ss">#:cl-ppcre</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 6</span><span class="p">(</span><span class="ss">:import-from</span><span class="w"> </span><span class="ss">#:alexandria</span><span class="w"></span>
<span class="linenos"> 7</span><span class="w">                </span><span class="ss">#:parse-body</span><span class="p">)</span><span class="w"></span>
<span class="linenos"> 8</span><span class="p">(</span><span class="ss">:import-from</span><span class="w"> </span><span class="ss">#:named-readtables</span><span class="w"></span>
<span class="linenos"> 9</span><span class="w">                </span><span class="ss">#:defreadtable</span><span class="w"></span>
<span class="linenos">10</span><span class="w">                </span><span class="ss">#:in-readtable</span><span class="p">)</span><span class="w"></span>
<span class="linenos">11</span><span class="p">(</span><span class="ss">:export</span><span class="w"> </span><span class="ss">#:lol-syntax</span><span class="w"></span>
<span class="linenos">12</span><span class="w">        </span><span class="ss">#:mkstr</span><span class="w"></span>
<span class="linenos">13</span><span class="w">        </span><span class="ss">#:symb</span><span class="w"></span>
<span class="linenos">14</span><span class="w">        </span><span class="ss">#:group</span><span class="w"></span>
<span class="linenos">15</span><span class="w">        </span><span class="ss">#:flatten</span><span class="w"></span>
<span class="linenos">16</span><span class="w">        </span><span class="ss">#:fact</span><span class="w"></span>
<span class="linenos">17</span><span class="w">        </span><span class="ss">#:choose</span><span class="w"></span>
<span class="linenos">18</span><span class="w">        </span><span class="ss">#:g!-symbol-p</span><span class="w"></span>
<span class="linenos">19</span><span class="w">        </span><span class="ss">#:defmacro/g!</span><span class="w"></span>
<span class="linenos">20</span><span class="w">        </span><span class="ss">#:o!-symbol-p</span><span class="w"></span>
<span class="linenos">21</span><span class="w">        </span><span class="ss">#:o!-symbol-to-g!-symbol</span><span class="w"></span>
<span class="linenos">22</span><span class="w">        </span><span class="ss">#:defmacro!</span><span class="w"></span>
<span class="linenos">23</span><span class="w">        </span><span class="ss">#:defun!</span><span class="w"></span>
<span class="linenos">24</span><span class="w">        </span><span class="ss">#:|#&quot;-reader|</span><span class="w"></span>
<span class="linenos">25</span><span class="w">        </span><span class="ss">#:segment-reader</span><span class="w"></span>
<span class="linenos">26</span><span class="w">        </span><span class="ss">#:match-mode-ppcre-lambda-form</span><span class="w"></span>
<span class="linenos">27</span><span class="w">        </span><span class="ss">#:subst-mode-ppcre-lambda-form</span><span class="w"></span>
<span class="linenos">28</span><span class="w">        </span><span class="ss">#:|#~-reader|</span><span class="w"></span>
<span class="linenos">29</span><span class="w">        </span><span class="ss">#:dlambda</span><span class="w"></span>
<span class="linenos">30</span><span class="w">        </span><span class="ss">#:alambda</span><span class="w"></span>
<span class="linenos">31</span><span class="w">        </span><span class="ss">#:aif</span><span class="w"></span>
<span class="linenos">32</span><span class="w">        </span><span class="ss">#:|#`-reader|</span><span class="w"></span>
<span class="linenos">33</span><span class="w">        </span><span class="ss">#:|#f-reader|</span><span class="w"></span>
<span class="linenos">34</span><span class="w">        </span><span class="ss">#:nlet-tail</span><span class="w"></span>
<span class="linenos">35</span><span class="w">        </span><span class="ss">#:alet%</span><span class="w"></span>
<span class="linenos">36</span><span class="w">        </span><span class="ss">#:alet</span><span class="w"></span>
<span class="linenos">37</span><span class="w">        </span><span class="ss">#:it</span><span class="w"></span>
<span class="linenos">38</span><span class="w">        </span><span class="ss">#:this</span><span class="w"></span>
<span class="linenos">39</span><span class="w">        </span><span class="ss">#:self</span><span class="w"></span>
<span class="linenos">40</span><span class="w">        </span><span class="ss">#:let-binding-transform</span><span class="w"></span>
<span class="linenos">41</span><span class="w">        </span><span class="ss">#:pandoriclet</span><span class="w"></span>
<span class="linenos">42</span><span class="w">        </span><span class="ss">#:pandoriclet-get</span><span class="w"></span>
<span class="linenos">43</span><span class="w">        </span><span class="ss">#:pandoriclet-set</span><span class="w"></span>
<span class="linenos">44</span><span class="w">        </span><span class="ss">#:get-pandoric</span><span class="w"></span>
<span class="linenos">45</span><span class="w">        </span><span class="ss">#:with-pandoric</span><span class="w"></span>
<span class="linenos">46</span><span class="w">        </span><span class="ss">#:pandoric-hotpatch</span><span class="w"></span>
<span class="linenos">47</span><span class="w">        </span><span class="ss">#:pandoric-recode</span><span class="w"></span>
<span class="linenos">48</span><span class="w">        </span><span class="ss">#:plambda</span><span class="w"></span>
<span class="linenos">49</span><span class="w">        </span><span class="ss">#:pandoric-eval</span><span class="w"></span>
<span class="linenos">50</span><span class="w">        </span><span class="ss">#:fast-progn</span><span class="w"></span>
<span class="linenos">51</span><span class="w">        </span><span class="ss">#:safe-progn</span><span class="w"></span>
<span class="linenos">52</span><span class="w">        </span><span class="ss">#:fformat</span><span class="w"></span>
<span class="linenos">53</span><span class="w">        </span><span class="ss">#:make-tlist</span><span class="w"></span>
<span class="linenos">54</span><span class="w">        </span><span class="ss">#:tlist-left</span><span class="w"></span>
<span class="linenos">55</span><span class="w">        </span><span class="ss">#:tlist-right</span><span class="w"></span>
<span class="linenos">56</span><span class="w">        </span><span class="ss">#:tlist-empty-p</span><span class="w"></span>
<span class="linenos">57</span><span class="w">        </span><span class="ss">#:tlist-add-left</span><span class="w"></span>
<span class="linenos">58</span><span class="w">        </span><span class="ss">#:tlist-add-right</span><span class="w"></span>
<span class="linenos">59</span><span class="w">        </span><span class="ss">#:tlist-rem-left</span><span class="w"></span>
<span class="linenos">60</span><span class="w">        </span><span class="ss">#:tlist-update</span><span class="w"></span>
<span class="linenos">61</span><span class="w">        </span><span class="ss">#:build-batcher-sn</span><span class="w"></span>
<span class="linenos">62</span><span class="w">        </span><span class="ss">#:sortf</span><span class="w"></span>
<span class="linenos">63</span><span class="w">        </span><span class="ss">#:dollar-symbol-p</span><span class="w"></span>
<span class="linenos">64</span><span class="w">        </span><span class="ss">#:prune-if-match-bodies-from-sub-lexical-scope</span><span class="w"></span>
<span class="linenos">65</span><span class="w">        </span><span class="ss">#:if-match</span><span class="w"></span>
<span class="linenos">66</span><span class="w">        </span><span class="ss">#:when-match</span><span class="p">))</span><span class="w"></span>
<span class="linenos">67</span>
<span class="linenos">68</span><span class="c1">;; EOF</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="readme-md">
<span id="id25"></span><h2>README.md<a class="headerlink" href="#readme-md" title="Permalink to this heading"></a></h2>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="gh"># LET-OVER-LAMBDA</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>[<span class="nt">![Build Status</span>](<span class="na">https://circleci.com/gh/thephoeron/let-over-lambda.svg?style=shield</span>)](https://circleci.com/gh/thephoeron/let-over-lambda)
<span class="linenos"> 4</span>[<span class="nt">![Build Status</span>](<span class="na">https://travis-ci.org/thephoeron/let-over-lambda.svg?branch=master</span>)](https://travis-ci.org/thephoeron/let-over-lambda)
<span class="linenos"> 5</span>[<span class="nt">![Coverage Status</span>](<span class="na">https://coveralls.io/repos/thephoeron/let-over-lambda/badge.svg?branch=master</span>)](https://coveralls.io/r/thephoeron/let-over-lambda)
<span class="linenos"> 6</span>[<span class="nt">![Quicklisp</span>](<span class="na">http://quickdocs.org/badge/let-over-lambda.svg</span>)](http://quickdocs.org/let-over-lambda/)
<span class="linenos"> 7</span>[<span class="nt">![BSD Simplified License</span>](<span class="na">https://img.shields.io/badge/license-BSD%20Simplified-blue.svg</span>)](./LICENSE)
<span class="linenos"> 8</span>[<span class="nt">![Join the chat at https://gitter.im/thephoeron/let-over-lambda</span>](<span class="na">https://badges.gitter.im/Join%20Chat.svg</span>)](https://gitter.im/thephoeron/let-over-lambda?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge)
<span class="linenos"> 9</span>
<span class="linenos">10</span>Doug Hoyte&#39;s &quot;Production&quot; version of macros from Let Over Lambda, including community updates; available from Quicklisp.
<span class="linenos">11</span>
<span class="linenos">12</span>Read more about the book and code at: http://letoverlambda.com
<span class="linenos">13</span>
<span class="linenos">14</span><span class="gu">## News &amp;amp; Updates</span>
<span class="linenos">15</span>
<span class="linenos">16</span><span class="gu">##### 3/19/2015</span>
<span class="linenos">17</span>
<span class="linenos">18</span>Add symbols for anaphoric macro internals, <span class="sb">`IT`</span>, <span class="sb">`THIS`</span>, and <span class="sb">`SELF`</span> to package exports for better end-user experience.  Will be available in April 2015 release of Quicklisp.
<span class="linenos">19</span>
<span class="linenos">20</span><span class="gu">##### 8/14/2014</span>
<span class="linenos">21</span>
<span class="linenos">22</span>Issue with incompatible change to backquote syntax in SBCL 1.2.2 resolved; tested against and builds on SBCL 1.2.0-1 and 1.2.2.  Will be available in the August release of Quicklisp.
<span class="linenos">23</span>
<span class="linenos">24</span><span class="gu">##### 12/18/2013</span>
<span class="linenos">25</span>
<span class="linenos">26</span>Now available in the December 2013 distribution of Quicklisp
<span class="linenos">27</span>
<span class="linenos">28</span><span class="gu">## Usage</span>
<span class="linenos">29</span>
<span class="linenos">30</span>Make sure you have the latest Quicklisp distribution, then include it as a dependency in your system definition, or from the REPL evaluate <span class="sb">`(ql:quickload &quot;let-over-lambda&quot;)`</span>.
<span class="linenos">31</span>
<span class="linenos">32</span><span class="sb">```lisp</span>
<span class="linenos">33</span><span class="p">(</span><span class="nv">ql:quickload</span><span class="w"> </span><span class="s">&quot;let-over-lambda&quot;</span><span class="p">)</span><span class="w"></span>
<span class="linenos">34</span><span class="p">(</span><span class="nv">lol:flatten</span><span class="w"> </span><span class="o">&#39;</span><span class="p">((</span><span class="nv">A</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="nv">B</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">C</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="nv">D</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">E</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="p">(</span><span class="nv">F</span><span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="nv">H</span><span class="w"> </span><span class="p">(</span><span class="nv">I</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="nv">J</span><span class="p">)</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="nv">K</span><span class="p">))))</span><span class="w"></span>
<span class="linenos">35</span><span class="nv">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nv">A</span><span class="w"> </span><span class="nv">B</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="nv">D</span><span class="w"> </span><span class="nv">E</span><span class="w"> </span><span class="nv">F</span><span class="w"> </span><span class="nv">G</span><span class="w"> </span><span class="nv">H</span><span class="w"> </span><span class="nv">I</span><span class="w"> </span><span class="nv">J</span><span class="w"> </span><span class="nv">K</span><span class="p">)</span><span class="w"></span>
<span class="linenos">36</span><span class="sb">```</span>
<span class="linenos">37</span>
<span class="linenos">38</span>LET-OVER-LAMBDA now uses the <span class="sb">`named-readtables`</span> library instead of modifying the global readtable. To use LOL reader macros in your Lisp source files, you will have to add both <span class="sb">`let-over-lambda`</span> and <span class="sb">`named-readtables`</span> to your project dependencies, and the following line after your call to <span class="sb">`in-package`</span>, in every source file you wish to use LOL syntax:
<span class="linenos">39</span>
<span class="linenos">40</span><span class="sb">```lisp</span>
<span class="linenos">41</span><span class="p">(</span><span class="nv">named-readtables:in-readtable</span><span class="w"> </span><span class="nv">lol:lol-syntax</span><span class="p">)</span><span class="w"></span>
<span class="linenos">42</span><span class="sb">```</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="gu">## Contributors</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="k">-</span> [<span class="nt">Doug Hoyte</span>](<span class="na">https://github.com/hoytech</span>)
<span class="linenos">47</span><span class="k">-</span> [<span class="nt">&quot;the Phoeron&quot; Colin J.E. Lupton</span>](<span class="na">https://github.com/thephoeron</span>)
<span class="linenos">48</span><span class="k">-</span> [<span class="nt">Jorge Gajon</span>](<span class="na">https://github.com/gajon</span>)
<span class="linenos">49</span><span class="k">-</span> [<span class="nt">Andr茅 Miranda</span>](<span class="na">https://github.com/EuAndreh/</span>)
</pre></div>
</div>
</section>
<section id="id26">
<h2>End<a class="headerlink" href="#id26" title="Permalink to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="original-code.html" class="btn btn-neutral float-left" title="源代码" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021-2022, oneforalone, Treyenuo.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>